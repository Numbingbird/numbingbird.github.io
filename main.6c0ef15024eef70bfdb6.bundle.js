/*! For license information please see main.6c0ef15024eef70bfdb6.bundle.js.LICENSE.txt */
(()=>{var t,e={18:(t,e,i)=>{"use strict";i(260);class s extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"ball"),this.name="ball",t.add.existing(this),t.physics.add.existing(this),t.anims.create({key:"roll",frames:t.anims.generateFrameNumbers("ball",{start:0,end:11}),frameRate:24,yoyo:!1,repeat:-1}),this.play("roll"),this.scaleX=this.scale,this.scaleY=this.scale}update(){super.update}SetRandomPosition(){this.setRandomPosition()}}class h extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i,s,h){super(t,e,i,"wall"),this.red=16711680,this.blue=255,this.black=0,this.name="staticWall",t.add.existing(this),t.physics.add.staticImage(this),this.scaleX=s,this.scaleY=h}update(){if(super.update,this.growth)return"updown"==this.growthDir&&this.SetSize(this.displayWidth,this.displayHeight+3.6),"leftright"==this.growthDir&&this.SetSize(this.displayWidth+3.6,this.displayHeight),!0}SetSize(t,e){this.setSize(t,e),this.setDisplaySize(t,e)}GetData(){return[this.x,this.y,this.displayWidth,this.displayHeight]}GetBounds(){return this.getBounds()}setGrowth(t){"up"==t&&(this.setOrigin(.5,1),this.growthDir="updown",this.tint=this.red),"down"==t&&(this.growthDir="updown",this.setOrigin(.5,0),this.tint=this.blue),"left"==t&&(this.growthDir="leftright",this.setOrigin(1,.5),this.tint=this.red),"right"==t&&(this.growthDir="leftright",this.setOrigin(0,.5),this.tint=this.blue)}CollideWithWall(){this.tint=this.black,this.growth=!1,this.name="grownWall"}SetColBlack(){this.CollideWithWall()}SetBounds(t){t?(this.SetSize(0,0),this.setOrigin(0,0),this.setPosition(t.x,t.y),this.SetSize(t.width,t.height)):console.log("crash caught")}}class r extends Phaser.Scene{constructor(){super({key:"MainJezzball"}),this.wallScale=.5,this.totalXMovement=0,this.totalYMovement=0,this.lastX=-1,this.lastY=-1}create(){this.devModeCheats=!1,this.screenWidth=this.cameras.main.width,this.screenHeight=this.cameras.main.height,this.growthDir="updown",this.growingWalls={red:null,blue:null},this.gridSize=16,this.lives=3,this.add.image(31,31,"heart").setDepth(10),this.livesDisp=this.add.text(54,5,this.lives,{fontFamily:'serif, Georgia, "Goudy Bookletter 1911", Times',fontSize:"52px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10),this.arrows=this.add.image(31,80,"arrows").setDepth(10),this.input.activePointer,this.input.on("pointerup",((t,e,i)=>{this.PointerUp(t,e,i)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.PrepLevel(!0)}PrepLevel(t=!1){var e,i,s,h,r,a;t&&(null===(e=this.groupBall)||void 0===e||e.clear(!0,!0),this.CreateBalls(),this.lives=2),this.levelTransition=!1,t&&(this.currLevel=0),this.currLevel++,this.currLevel<50&&this.CreateBall(),this.lives=this.currLevel+1,this.livesDisp.setText(this.lives),null===(i=this.scoreDisp)||void 0===i||i.destroy(),null===(s=this.groupStaticWall)||void 0===s||s.clear(!0,!0),this.growingWalls={red:null,blue:null},this.createStaticWalls(),this.RandomBallInit(),this.SetCollidersSameArray(null===(h=this.groupBall)||void 0===h?void 0:h.getChildren()),this.SetCollidersBetweenArray(null===(r=this.groupBall)||void 0===r?void 0:r.getChildren(),null===(a=this.groupStaticWall)||void 0===a?void 0:a.getChildren());var o=Math.floor(this.screenWidth/this.gridSize),l=Math.floor(this.screenHeight/this.gridSize);this.cache=Array.from({length:o},((t,e)=>Array.from({length:l},((t,e)=>!1)))),this.totalCells=o*l,console.log(o*l),this.cellsFilled=0}CreateBalls(){this.groupBall=this.physics.add.group({defaultKey:"ball",key:"ball",frameQuantity:1,bounceX:1,bounceY:1,mass:1,collideWorldBounds:!0,classType:s})}CreateBall(){var t;null===(t=this.groupBall)||void 0===t||t.create(this.cameras.main.width/2,0,"ball")}RandomBallInit(){var t;(null===(t=this.groupBall)||void 0===t?void 0:t.getChildren()).forEach((t=>{let e=this.devModeCheats?100:150;var i=this.GenBallSpawnPos();t.setPosition(i.x,i.y),t.setVelocity(e*(Math.random()>.5?1:-1),e*(Math.random()>.5?1:-1))}))}GenBallSpawnPos(){for(var t,e={x:0,y:0},i=0;i<50;)if(i++,e.x=Math.random()*this.screenWidth,e.x=this.Clamp(e.x,9,this.screenWidth-9),e.y=Math.random()*this.screenHeight,e.y=this.Clamp(e.y,9,this.screenHeight-9),t=this.MakeBounds(e.x-9,e.y-9,18,18),!this.CompareBoundsAny(t,this.groupStaticWall)&&!this.CompareBoundsAny(t,this.groupBall))return e;return console.log("max loops, no spawn found"),e}Clamp(t,e,i){return Math.min(Math.max(t,e),i)}StopAllBalls(){var t;(null===(t=this.groupBall)||void 0===t?void 0:t.children.entries).forEach((t=>{t.setVelocity(0,0)}))}createStaticWalls(){var t;this.groupStaticWall=this.physics.add.staticGroup({defaultKey:"staticWall",classType:h}),this.gridSize;var e=this.gridSize,i=this.screenHeight,s=this.screenWidth;this.CreateStaticWallBounds(-e,-e,e,i+e),this.CreateStaticWallBounds(s,-e,e,i+e),this.CreateStaticWallBounds(-e,-e,s+e,e),this.CreateStaticWallBounds(-e,i,s+e,e);var r=null===(t=this.groupStaticWall)||void 0===t?void 0:t.getChildren();for(let t=0;t<r.length;t++)r[t].growth=!1,r[t].name="borderWall"}createStaticWallAt(t,e,i,s){var r,a=new h(this,t,e,i,s);return null===(r=this.groupStaticWall)||void 0===r||r.add(a),a}CreateStaticWallBounds(t,e,i,s){var r,a=this.MakeBounds(t,e,i,s),o=new h(this,a.x,a.y,1,1);return null===(r=this.groupStaticWall)||void 0===r||r.add(o),o.SetBounds(a),o.SetColBlack(),o}createWallHelper(t){var e=this.createStaticWallAt(t.x,t.y,this.wallScale,this.wallScale);return e.growth=!0,e.name="growingWall",e}PointerUp(t,e,i){t.getDistance()<1?this.clickAction(this.initialDownPos):this.totalXMovement>this.totalYMovement?(this.growthDir="leftright",this.clickAction(this.initialDownPos),this.arrows.setAngle(-90)):(this.growthDir="updown",this.clickAction(this.initialDownPos),this.arrows.setAngle(0))}PointerDown(t){this.totalXMovement=0,this.totalYMovement=0,this.initialDownPos={x:t.x,y:t.y}}createWall(t){if(!this.growingWalls.red||"growingWall"!==this.growingWalls.red.name&&"growingWall"!==this.growingWalls.blue.name){var e=this.WallSpawnGridPoint(t);if(!this.CheckCacheFilled(e.x,e.y)){this.wallsGrown=0,this.wallDestroyed=!1;var i=this.createWallHelper(e);this.growingWalls.red=i,"updown"==this.growthDir?i.setGrowth("up"):i.setGrowth("left"),i=this.createWallHelper(e),this.growingWalls.blue=i,"updown"==this.growthDir?i.setGrowth("down"):i.setGrowth("right")}}}clickAction(t){this.levelTransition||this.createWall(t)}TrackMovement(){var t=this.input.activePointer;-1==this.lastX&&(this.lastX=t.x),-1==this.lastY&&(this.lastY=t.y),this.totalXMovement+=Math.abs(this.lastX-t.x),this.totalYMovement+=Math.abs(this.lastY-t.y),this.lastX=t.x,this.lastY=t.y,this.totalXMovement>this.totalYMovement?this.arrows.setAngle(-90):this.arrows.setAngle(0)}WallSpawnGridPoint(t){const e="updown"==this.growthDir;return{x:this.GridHelper(t.x,e),y:this.GridHelper(t.y,!e)}}NearestGridPoint(t){return{x:this.GridHelper(t.x,!1),y:this.GridHelper(t.y,!1)}}NearestGridCenterPoint(t){return{x:this.GridHelper(t.x,!0),y:this.GridHelper(t.y,!0)}}GridHelper(t,e=!1){const i=this.gridSize;var s,h=0;return e&&(h=i/2),(s=(s=i*Math.floor((t+i/2)/i))+(Math.sign(t-s)>=0?1:-1)*h)<0&&(s=0),s}AlignBoundsToGrid(t){var e=this.GridHelper(t.x),i=this.GridHelper(t.y);return this.MakeBounds(e,i,this.GridHelper(t.x+t.width)-e,this.GridHelper(t.y+t.height)-i)}SetCollidersSameArray(t){for(let e=0;e<t.length;e++){for(let i=e;i<t.length;i++)this.physics.add.collider(t[e],t[i]);t[e].body.onCollide=!0}}SetCollidersBetweenArray(t,e){for(let i=0;i<t.length;i++)for(let s=0;s<e.length;s++)this.physics.add.collider(t[i],e[s])}SetCollidersToArray(t,e){this.physics.add.collider(t,e)}SetCollidersToArrays(t,e,i){this.physics.add.collider(t,e),this.physics.add.collider(t,i)}collideListener(t,e,i,s){var h,r=!1;"growingWall"===t.name&&(h=t,r=!0),"growingWall"===e.name&&(h=e,r=!0),r&&1==h.growth&&(this.DestroyWall(h),r=!1)}DestroyWall(t,e=!0){t.destroy(),t.name="destroyedWall",this.wallsGrown=-1,this.wallDestroyed=!0,e&&this.CheckLose()}update(){try{this.trycatch()}catch(t){console.log("crash caught",t)}}trycatch(){var t,e;this.TrackMovement();var i=this.growingWalls.red,s=this.growingWalls.blue;if(this.CheckGrowingWalls(i,"red")||this.CheckGrowingWalls(s,"blue")){if(this.wallDestroyed)return;var h=this.GetBoundsCombinationOf(i,s);i.SetBounds(h),s.destroy()}null===(t=this.groupStaticWall)||void 0===t||t.children.entries.forEach((t=>{t.update()})),null===(e=this.groupStaticWall)||void 0===e||e.refresh()}CheckGrowingWalls(t,e){var i,s;if(!t)return!1;if(null==t)return!1;if(!t.growth)return!1;if("growingWall"!=t.name)return!1;let h=t.GetBounds();var r=!1;return(null===(i=this.groupBall)||void 0===i?void 0:i.children.entries).forEach((e=>{if(r)return;let i=e.getBounds();this.CompareBounds(i,h)&&(r=!0,this.collideListener(e,t,1,1))})),!r&&((null===(s=this.groupStaticWall)||void 0===s?void 0:s.children.entries).forEach((e=>{var i;if(e===t)return!1;if(e.growth)return!1;let s=e.GetBounds();this.CompareBounds(s,h)&&(this.ResolveToBlack(t),this.SetCollidersToArray(t,null===(i=this.groupBall)||void 0===i?void 0:i.getChildren()),this.wallsGrown++)})),2==this.wallsGrown||void 0)}ResolveToBlack(t){var e=t.getBounds();if(t.CollideWithWall(),t.SetBounds(this.AlignBoundsToGrid(t.getBounds())),e=t.getBounds(),this.OutsideCacheArrayLengths(e.x/this.gridSize,e.y/this.gridSize))this.DestroyWall(t,!1);else{var i=this.FillCache(t.getBounds());this.CheckExpansion(i)}}FillCache(t){const e=this.gridSize;for(var i=Array(),s=t.x;s<t.x+t.width;s+=e)for(var h=t.y;h<t.y+t.height;h+=e)this.OutsideCacheArrayLengths(s/e,h/e)||(this.cache[s/e][h/e]=!0,this.cellsFilled++,i.push({x:s/e,y:h/e}));return this.CheckLevelWin(),i}CheckCacheFilled(t,e){return t=Math.floor(t/this.gridSize),e=Math.floor(e/this.gridSize),!this.OutsideCacheArrayLengths(t,e)&&this.cache[t][e]}OutsideCacheArrayLengths(t,e){return t<0||e<0||t>=this.cache.length||e>=this.cache[0].length}CheckExpansion(t){var e,i=this.cache.map((t=>t.slice()));[[0,1],[0,-1],[1,0],[-1,0]].forEach((s=>{t.forEach((t=>{var h={x:t.x+s[0],y:t.y+s[1]};if(e={minx:h.x,miny:h.y,maxx:h.x,maxy:h.y},this.FloodFillStart(this.cache,i,h.x,h.y,e),e.minx!=e.maxx||e.miny!=e.maxy){const t=this.gridSize;e.minx*=t,e.miny*=t,e.maxx*=t,e.maxy*=t;var r=this.MakeBounds(e.minx,e.miny,e.maxx-e.minx+t,e.maxy-e.miny+t);this.CompareBoundsAny(r,this.groupBall)||(this.CreateStaticWallBounds(r.x,r.y,r.width,r.height),this.FillCache(r))}}))}))}FloodFillStart(t,e,i,s,h){this.queue=Array(),this.queue.push([i,s]),this.FloodFillQueue(this.cache,e,i,s,h)}FloodFillQueue(t,e,i,s,h){for(;0!=this.queue.length;){var r=this.queue.shift();i=r[0],s=r[1],i<0||s<0||i>=t.length||s>=t[0].length||t[i][s]||e[i][s]||(e[i][s]=!0,this.FloodFillQueueHelp(t,e,i,s,h))}}FloodFillQueueHelp(t,e,i,s,h){this.queue.push([i+1,s]),this.queue.push([i-1,s]),this.queue.push([i,s+1]),this.queue.push([i,s-1]),h.minx=Math.min(i,h.minx),h.miny=Math.min(s,h.miny),h.maxx=Math.max(i,h.maxx),h.maxy=Math.max(s,h.maxy)}CacheDebug(t,e=3){var i=t;if(0==e)for(var s=0;s<i.length;s++)for(var h=0;h<i[0].length;h++)console.log(i[s][h]);if(1==e)for(s=0;s<i[0].length;s++)for(h=0;h<i.length;h++)console.log(i[h][s]);if(2==e&&console.log(this.cache),3==e){var r=Array(),a=Array();for(s=0;s<i[0].length;s++){for(r=Array(),h=0;h<i.length;h++)r.push(i[h][s]?"■":"");a.push(r)}console.log(a)}}CheckLose(){if(this.lives--,this.livesDisp.setText(this.lives),!(this.lives>0||this.lives<0||this.levelTransition)){this.levelTransition=!0,this.scoreDisp=this.add.text(12,120,"Score : "+(this.currLevel*Phaser.Math.Between(1e4,12e3)).toString(),{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',fontSize:"40px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10),this.StopAllBalls();var t=this.add.image(this.screenWidth/2,this.screenHeight/2,"restart").setInteractive();t.once("pointerup",(e=>{this.PrepLevel(!0),t.destroy()}))}}CheckLevelWin(){if(!(this.cellsFilled/this.totalCells<.6||this.levelTransition)){this.levelTransition=!0,this.StopAllBalls();var t=this.add.image(this.screenWidth/2,this.screenHeight/2,"nextLevel").setInteractive();t.once("pointerup",(e=>{this.PrepLevel(),t.destroy()}))}}MakeBounds(t,e,i,s){return{x:t,y:e,width:i,height:s}}GetBoundsCombinationOf(t,e){var i=t.getBounds(),s=e.getBounds(),h=Math.min(i.x,s.x),r=Math.min(i.y,s.y),a=Math.max(i.x+i.width,s.x+s.width),o=Math.max(i.y+i.height,s.y+s.height);return this.MakeBounds(h,r,a-h,o-r)}CompareBounds(t,e,i=!1){return t&&e&&t.width&&t.height&&e.width&&e.height||console.log("bad wall spawn; caught"),i&&(console.log("comparing"),console.log(t),console.log(e),console.log(t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y)),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}CompareBoundsAny(t,e,i=!1){var s=!1;return(null==e?void 0:e.children.entries).forEach((e=>{if(s)return!0;this.CompareBounds(t,e.getBounds(),i)&&(s=!0)})),s}}class a extends Phaser.Scene{constructor(){super({key:"PreloadJezzball"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.spritesheet("ball","assets/img/jezzballs.png",{frameHeight:16,frameWidth:16}),this.load.image("heart","assets/img/heart.png"),this.load.image("arrows","assets/img/arrows.png"),this.load.image("restart","assets/img/restart.png"),this.load.image("nextLevel","assets/img/nextLevel.png")}create(){this.scene.start("MainJezzball")}}class o{static Lerp(t,e,i){return(1-i)*t+i*e}static PLerp(t,e,i,s=3){return this.Lerp(t,e,Math.pow(i,s))}static OffsetToScreenSpace(t,e,i){var s=this.OffsetToScreenZ(t);return[this.Lerp(t[0]*e[1]*2,t[0]*e[0]*2,s)+i[0]/2,this.Lerp(t[1]*e[1]*2,t[1]*e[0]*2,s)+i[1]/2]}static OffsetToScreenZ(t){return 2*Math.tan((t[2]+1)/2)/Math.PI}static OffsetToScreenSize(t){return.35*t[2]+.65}static OffsetToScreenLineWidth(t){return.45*t+.55}static Clamp(t,e,i){return Math.min(Math.max(t,e),i)}}class l extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"ball"),this.name="ball",this.pos=[0,0,0],this.vel=[0,0,0],this.accel=[0,0,0],this.distWall=[0,0,1],this.moving=!1,this.red=16515843,this.green=261144,this.ballRadius=[30,30,0],this.flagCheckGoal=!1,this.flagBeenInBounds=!0,t.add.existing(this),this.PrepStart()}PrepStart(){this.moving=!1,this.pos=[0,0,1],this.vel=[0,0,0],this.accel=[0,0,0],this.tint=this.green}SetDims(t,e,i){this.boxDims=t,this.boxFactors=e,this.screenSize=i,this.distWall[0]=this.boxDims[0],this.distWall[1]=this.boxDims[1]}SetVelZ(t){this.moving=!0,this.vel[2]=t}SetEnd(){this.moving=!1,this.tint=this.red}SetPos(t){this.pos[0]=this.distWall[0],this.pos[1]=this.distWall[1],this.pos[2]=-1}AddVel(t){for(var e=0;e<2;e++)this.vel[e]+=1.3*t[e]}AddAccel(t){for(var e=0;e<2;e++)this.accel[e]*=.5,this.accel[e]+=-.001*t[e]}update(t,e){super.update(),this.PhysicsStep(e);var i=this.pos,s=o.OffsetToScreenSpace(i,this.boxFactors,this.screenSize);this.setPosition(s[0],s[1]);var h=o.OffsetToScreenSize(i)*this.ballRadius[0]*2;this.setDisplaySize(h,h)}PhysicsStep(t){if(this.moving)for(var e=0;e<3;e++)this.vel[e]+=this.accel[e]*t,this.pos[e]+=this.vel[e]*t,Math.abs(this.pos[e])+this.ballRadius[e]>this.distWall[e]?(2==e?this.flagBeenInBounds&&(this.flagBeenInBounds=!1,this.flagCheckGoal=!0):this.accel[e]*=.8,Math.sign(this.vel[e])==Math.sign(this.pos[e])&&(this.vel[e]*=-1)):this.flagBeenInBounds=!0}FlagChecked(){this.flagCheckGoal=!1}}class n extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"panelB"),this.name="panel",this.pos=[0,0,-1],this.prevPos=[0,0,-1],this.cpu=!1,this.vel=[0,0],this.followPct=5e-4,this.pointerPos=[0,0],t.add.existing(this),this.alpha=.4}SetDims(t,e,i){this.boxDims=t,this.boxFactors=e,this.screenSize=i}SetPlayerStuff(t){this.setTexture("panelA"),this.pos=[0,0,1],this.SetDisplaySize(),this.ball=t}SetCpuStuff(t){this.ball=t,this.cpu=!0,this.SetDisplaySize()}SetDisplaySize(){this.spriteSize=[100,70];var t=o.OffsetToScreenSize(this.pos);this.setDisplaySize(t*this.spriteSize[0],t*this.spriteSize[1])}update(t,e){super.update();var i=this.pos;this.prevPos=[i[0],i[1],i[2]],this.cpu?this.FollowBall(e):this.FollowPointer(e),this.RecordVelocity(e);var s=o.OffsetToScreenSpace(i,this.boxFactors,this.screenSize);this.setPosition(s[0],s[1])}FollowBall(t){var e=this.ball.pos;(this.ball.vel[2]>=0||!this.ball.moving)&&(e=[0,0]);for(var i=0;i<2;i++)this.pos[i]=o.Lerp(this.pos[i],e[i],o.Clamp(this.followPct*t,5e-4,1))}SetFollowPct(t){this.followPct=35e-6*Math.pow(t+2,2)}SetInitPos(){for(var t=0;t<2;t++)this.pointerPos[t]=this.screenSize[t]/2}SetPosition(t){for(var e=[t.x,t.y],i=0;i<2;i++)this.pointerPos[i]=e[i]}FollowPointer(t){for(var e=0;e<2;e++)this.pos[e]=o.Lerp(this.pos[e],this.pointerPos[e]-this.screenSize[e]/2,o.Clamp(.1*t,0,1));this.setPosition(this.pos[0],this.pos[1])}RecordVelocity(t){for(var e=this.vel,i=this.prevPos,s=0;s<2;s++)e[s]=(this.pos[s]-i[s])*t;var h=Math.pow(Math.pow(e[0],2)+Math.pow(e[1],2),.5);if(0!=h)for(h*=1.3,s=0;s<2;s++)e[s]=e[s]/h*o.Clamp(h,0,.2)}}class d extends Phaser.Scene{constructor(){super({key:"MainCurveball"}),this.devModeCheats=!0}create(){this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.lives=3,this.add.image(32,32,"heart").setDepth(10),this.livesDisp=this.AddText(54,5,this.lives),this.add.image(32,80,"speed").setDepth(10),this.speedDisp=this.AddText(54,50,1),this.boxFactors=[.49,.12],this.boxDims=[this.screenSize[0]*this.boxFactors[0],this.screenSize[1]*this.boxFactors[0],this.screenSize[0]*this.boxFactors[1],this.screenSize[1]*this.boxFactors[1]];var t=[this.screenSize[0]/2,this.screenSize[1]/2];this.ball=new l(this,t[0],t[1]).setDepth(1),this.panelA=new n(this,t[0],t[1]).setDepth(2),this.panelB=new n(this,t[0],t[1]),this.ball.SetDims(this.boxDims,this.boxFactors,this.screenSize),this.panelA.SetDims(this.boxDims,this.boxFactors,this.screenSize),this.panelA.SetPlayerStuff(this.ball),this.panelB.SetDims(this.boxDims,this.boxFactors,this.screenSize),this.panelB.SetCpuStuff(this.ball),this.DrawLines(),this.trackingRect=this.add.rectangle(this.screenSize[0]/2,this.screenSize[1]/2,500,500).setOrigin(.5,.5),this.trackingRect.isStroked=!0,this.trackingRect.strokeColor=16777215,this.NextLevel(!0),this.input.activePointer,this.input.on("pointermove",(t=>{this.UpdatePlayerPanel(t),this.StartLevel()})),this.input.on("pointerdown",(t=>{this.StartLevel()}))}AddText(t,e,i){return this.add.text(t,e,i,{fontFamily:'serif, Georgia, "Goudy Bookletter 1911", Times',fontSize:"52px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10)}StartLevelAutoTesting(){this.ball.SetVelZ(-.001)}DrawLines(){for(var t=.1,e=-1;e<1;e+=t)t+=.0335,this.DrawBox(e);this.DrawBox(1);var i=o.OffsetToScreenLineWidth(-1);this.DrawLine(!0,!0,!0,!0,-1,1,i,1),this.DrawLine(!0,!1,!0,!1,-1,1,i,1),this.DrawLine(!1,!0,!1,!0,-1,1,i,1),this.DrawLine(!1,!1,!1,!1,-1,1,i,1)}DrawBox(t){var e=o.OffsetToScreenLineWidth(t);this.DrawLine(!0,!0,!0,!1,t,t,e,e),this.DrawLine(!0,!0,!1,!0,t,t,e,e),this.DrawLine(!1,!1,!0,!1,t,t,e,e),this.DrawLine(!1,!1,!1,!0,t,t,e,e)}DrawLine(t,e,i,s,h,r,a,o){var l=this.DrawLineGetPoint(t,e,h),n=this.DrawLineGetPoint(i,s,r);this.add.line(0,0,l[0],l[1],n[0],n[1],31238).setOrigin(0,0).setLineWidth(a,o)}DrawLineGetPoint(t,e,i){i=.5*i+.5;var s=o.Lerp(this.boxDims[2],this.boxDims[0],i),h=o.Lerp(this.boxDims[3],this.boxDims[1],i),r=this.screenSize[0]/2,a=this.screenSize[1]/2;return t?r-=s:r+=s,e?a-=h:a+=h,[r,a]}UpdatePlayerPanel(t){this.panelA.SetPosition(t)}NextLevel(t=!1){t&&(this.lives=0,this.currLevel=0,this.panelA.SetInitPos()),this.currLevel++,this.currLevel%2&&this.lives++,this.livesDisp.setText(this.lives),this.speedDisp.setText(this.currLevel),this.panelB.SetFollowPct(this.currLevel),this.panelB.SetInitPos(),this.BallToStart(),this.lost=!1,this.levelTransition=!1}BallToStart(){this.levelTransition=!1,this.ball.PrepStart()}StartLevel(){this.ball.moving||this.input.activePointer.isDown&&(this.levelTransition||this.CheckWithinPanel(this.ball,this.panelA)&&(this.ball.SetVelZ(-15e-5*this.currLevel-.001),this.BallHitByPanel(this.panelA)))}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.ball.update(t,e),this.panelA.update(t,e),this.panelB.update(t,e);var i=o.OffsetToScreenZ(this.ball.pos);this.trackingRect.setDisplaySize(o.Lerp(2*this.boxDims[2],2*this.boxDims[0],i),o.Lerp(2*this.boxDims[3],2*this.boxDims[1],i)).lineWidth=o.OffsetToScreenLineWidth(i),this.CheckGoal()}CheckLose(t){if(this.lives--,this.livesDisp.setText(this.lives),!(this.lives>0||this.lives<0||this.lost)){this.lost=!0,t.destroy();var e=this.add.image(this.screenSize[0]/2,this.screenSize[1]/2,"restart").setInteractive().setDepth(10);e.once("pointerup",(t=>{this.NextLevel(!0),e.destroy()}))}}CheckGoal(){if(this.ball.flagCheckGoal&&!this.levelTransition){this.ball.FlagChecked();var t,e=!0;if(this.ball.pos[2]>0?t=this.panelA:(t=this.panelB,e=!1),this.CheckWithinPanel(this.ball,t))this.BallHitByPanel(t);else if(this.ball.SetEnd(),this.levelTransition=!0,e){var i=this.time.delayedCall(1e3,this.BallToStart,Array(),this);this.CheckLose(i)}else i=this.time.delayedCall(1e3,this.NextLevel,Array(),this)}}CheckWithinPanel(t,e){for(var i=t.pos,s=0;s<2;s++)if(!(Math.abs(i[s]-e.pos[s])<e.spriteSize[s]/2+t.ballRadius[s]))return!1;return!0}BallHitByPanel(t){this.ball.AddVel(t.vel),this.ball.AddAccel(t.vel)}}class c extends Phaser.Scene{constructor(){super({key:"PreloadCurveball"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.image("ball","assets/img/ball.png"),this.load.image("panelA","assets/img/panelA.png"),this.load.image("panelB","assets/img/panelB.png"),this.load.image("heart","assets/img/heart.png"),this.load.image("speed","assets/img/speed.png"),this.load.image("restart","assets/img/restart.png"),this.load.image("nextLevel","assets/img/nextLevel.png")}create(){this.scene.start("MainCurveball")}}class p{static Lerp(t,e,i){return(1-i)*t+i*e}static PLerp(t,e,i,s=3){return this.Lerp(t,e,Math.pow(i,s))}static Clamp(t,e,i){if(e>i){var s=i;i=e,e=s}return Math.min(Math.max(t,e),i)}static BoardSpaceXY(t,e,i,s,h,r=100,a=100){var o=t[0]>t[1]?1:0,l=t[o],n=t[0==o?1:0],d={x:0==o?0:(n-l)/2,y:1==o?1:(n-l)/2};0==r&&(r=100);var c=l/r;0==a&&(a=100);var u=l/a,g=p.LayoutSpace(s,e,t[0],u,d.x,c),S=p.LayoutSpace(h,i,t[1],u,d.y,c);return{x:g.pos,y:S.pos,width:g.size,height:S.size}}static LayoutSpace(t,e,i,s=0,h=0,r=0){var a=i-2*h-r,o=a/e-s;return{pos:h+r/2+a/2+(s+o)*(t-(e-1)/2),size:o}}static FitBackgroundToScreen(t,e,i){var s;s=i.x/i.y<t.x/t.y?t.x/i.x:t.y/i.y,e.setDisplaySize(i.x*s,i.y*s)}static OOB(t,e){return t<0||t>=e}static Init2DArray(t,e){return Array.from({length:t},((t,i)=>Array.from({length:e},((t,e)=>!1))))}static PointWithinBounds(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height}static PointInCircle(t,e,i){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<=Math.pow(i,2)}static CheckCirclesOverlap(t,e,i,s){var h=i+s;return this.PointInCircle(t,e,h)}static CheckCircleRectIntersect(t,e,i){var s=Math.abs(t.x-i.x),h=Math.abs(t.y-i.y);return!(s>i.width/2+e||h>i.height/2+e||!(s<=i.width/2||h<=i.height/2||Math.pow(s-i.width/2,2)+Math.pow(h-i.height/2,2)<=Math.pow(e,2)))}static DegToRad(t){return t*(Math.PI/180)}static RadToDeg(t){return t*(180/Math.PI)}static FindCloserV2(t,e,i){return Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)<Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)?e:i}static FloatThreshold(t,e,i){return(t-e<0?-1*(t-e):t-e)<=i}static ApproxFloat(t,e,i=-1){return i<=0&&(i=1e-9),this.FloatThreshold(t,e,i)}static ApproxV2(t,e,i=-1){return this.ApproxFloat(t.x,e.x,i)&&this.ApproxFloat(t.y,e.y,i)}static DirTowards(t,e){var i=new Phaser.Math.Vector2(e.x,e.y);return(i=i.subtract(t)).normalize(),i}static V2Dist(t,e){var i=new Phaser.Math.Vector2(e.x,e.y);return(i=i.subtract(t)).length()}static V2TurnTowards(t,e){var i=e-t;return i>=1.2*Math.PI&&(i-=2*Math.PI),i<=1.2*-Math.PI&&(i+=2*Math.PI),i}static AngToV2(t){return new Phaser.Math.Vector2(Math.cos(t),Math.sin(t))}static RainbowColor(t){var e=127*Math.sin(t+0)+128,i=127*Math.sin(t+2)+128,s=127*Math.sin(t+4)+128;return Phaser.Display.Color.GetColor(e,i,s)}}class u extends Phaser.Scene{constructor(){super({key:"MainGhostleg"}),this.linesToGen=16,this.polesCount=5,this.maxYDist=70,this.minDistBetweenLines=30,this.playAreaMaxY=1e3,this.phaseButtonYOffset=80,this.iconYOffset=80,this.iconsCount=5,this.inputMode=-1,this.UIElements=Array(),this.chanceStraightLine=.6,this.poleYSpacer=70,this.sideSpacer=50,this.lineYSpacer=60,this.colRed=13699584,this.colGreen=58942,this.colWhite=16777215,this.inputModes={draw:0,erase:1},this.devModeCheats=!0,this.lineCount=0,this.lastY=-1,this.currScroll=0,this.lineWidth=4,this.currentPhase=-1}create(){this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.linesDrawn=this.physics.add.group({}),this.polesDrawn=this.physics.add.group({}),this.traceDrawn=this.physics.add.group({}),this.SetBounds(),this.hideScreen=this.add.image(this.screenSize[0]/2,this.playAreaMaxY/2,"wall").setDepth(10).setAlpha(.8).setTint(3355182).setDisplaySize(this.screenSize[0],this.playAreaMaxY-2*(this.poleYSpacer+this.lineYSpacer-this.lineWidth)),this.DrawPoles(),this.NextPhase(),this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)})),this.IndToPosSetup(0),this.randButton=this.MakeIcon(0,"random"),this.minusButton=this.MakeIcon(1,"minus"),this.plusButton=this.MakeIcon(2,"plus"),this.eraseButton=this.MakeIcon(3,"erase"),this.drawButton=this.MakeIcon(4,"draw"),this.ManageUIElements(this.randButton,this.iconYOffset),this.ManageUIElements(this.plusButton,this.iconYOffset),this.ManageUIElements(this.minusButton,this.iconYOffset),this.ManageUIElements(this.eraseButton,this.iconYOffset,this.inputModes.erase),this.ManageUIElements(this.drawButton,this.iconYOffset,this.inputModes.draw),this.randButton.on("pointerup",(t=>{this.RefreshLines()})),this.plusButton.on("pointerup",(t=>{this.ChangePolesCount(this.polesCount+1)})),this.minusButton.on("pointerup",(t=>{this.ChangePolesCount(this.polesCount-1)})),this.eraseButton.on("pointerup",(t=>{this.InputMode(this.inputModes.erase)})),this.drawButton.on("pointerup",(t=>{this.InputMode(this.inputModes.draw)}))}MakeIcon(t,e){return this.add.image(this.IndToPos(t,0),this.screenSize[1]-this.iconYOffset,e).setInteractive().setDepth(10)}ManageUIElements(t,e,i=-10){this.UIElements.push({element:t,offset:e,mode:i})}UIElementHighlight(t){for(var e=this.colWhite,i=this.colGreen,s=0;s<this.UIElements.length;s++)this.UIElements[s].element.tint=t==this.UIElements[s].mode?i:e}ResetLines(){var t,e;null===(t=this.linesDrawn)||void 0===t||t.clear(!0,!0),null===(e=this.traceDrawn)||void 0===e||e.clear(!0,!0),this.linesOrdered=Array();for(var i=0;i<this.polesCount;i++)this.linesOrdered.push(Array())}ResetTrace(){var t;null===(t=this.traceDrawn)||void 0===t||t.clear(!0,!0)}CreateLines(t){for(var e=0;e<t;e++)this.CreateRandomLine()}CreateRandomLine(){for(var t=0;t<50;t++){var e=this.RandY1(),i=Phaser.Math.FloatBetween(0,1)<this.chanceStraightLine?e:this.RandY2(e),s=Phaser.Math.Between(0,this.polesCount-2);if(0!=this.ProposeLine(e,i,s))return this.CreateALine(e,i,s)}return console.log("failed spawn"),-1}RandY1(){return Phaser.Math.FloatBetween(this.poleYSpacer+this.lineYSpacer,this.playAreaMaxY-this.lineYSpacer-this.poleYSpacer)}RandY2(t){var e=Phaser.Math.FloatBetween(t+this.maxYDist,t-this.maxYDist);return this.ClampToPlayY(e)}ClampToPlayY(t){return p.Clamp(t,this.poleYSpacer+this.lineYSpacer,this.playAreaMaxY-this.lineYSpacer-this.poleYSpacer)}CreateALine(t,e,i){var s={y1:t,y2:e,poleInd:i};return this.linesOrdered[s.poleInd].push(s),this.lineCount++,s}CheckLineValueDist(t,e,i){if(-1==t)return!0;if(t>=this.linesOrdered.length)return!0;if(0==this.linesOrdered[t].length)return!0;for(var s=0;s<this.linesOrdered[t].length;s++){var h;if(h="left"==i?this.linesOrdered[t][s].y1:this.linesOrdered[t][s].y2,Math.abs(h-e)<=this.minDistBetweenLines)return!1}return!0}CheckOverlap(t,e,i){for(var s=0;s<this.linesOrdered[t].length;s++)if(Math.sign(this.linesOrdered[t][s].y1-e)!=Math.sign(this.linesOrdered[t][s].y2-i))return!1;return!0}ProposeLine(t,e,i){var s=this.CheckLineValueDist(i-1,t,"right"),h=this.CheckLineValueDist(i,t,"left"),r=this.CheckLineValueDist(i,e,"right"),a=this.CheckLineValueDist(i+1,e,"left"),o=this.CheckOverlap(i,t,e);return s&&h&&r&&a&&o}DrawPoles(){for(var t,e=0;e<this.polesCount;e++){var i=this.PoleToPos(e),s=this.DrawGhostLegLine(i,this.poleYSpacer,i,this.playAreaMaxY-this.poleYSpacer);null===(t=this.polesDrawn)||void 0===t||t.add(s)}}DrawLines(){var t;null===(t=this.linesOrdered)||void 0===t||t.forEach((t=>{null==t||t.forEach((t=>{this.DrawLine(t)}))}))}DrawLine(t){var e,i=this.PoleToPos(t.poleInd),s=this.PoleToPos(t.poleInd+1),h=this.DrawGhostLegLine(i,t.y1,s,t.y2);return null===(e=this.linesDrawn)||void 0===e||e.add(h),t.drawn=h,h}DrawGhostLegLine(t,e,i,s){return this.add.line(0,0,t,e,i,s,this.colWhite).setOrigin(0,0).setLineWidth(this.lineWidth)}PoleToPos(t){var e=this.GetPoleSpacing();return e.sides+t*e.between}GetPoleSpacing(){var t=this.sideSpacer;return{sides:t,between:(this.screenSize[0]-t-t)/(this.polesCount-1)}}PosToPole(t){var e,i;if(t>=this.PoleToPos(this.polesCount-1))return this.polesCount-1;for(var s=0;s<this.polesCount;s++)if(t<this.PoleToPos(s)){i=s,e=s-1;break}return e<0?i:i>=this.polesCount?this.polesCount-1:Math.abs(this.PoleToPos(e)-t)<Math.abs(this.PoleToPos(i)-t)?e:i}PosCorrectToPole(t){return this.PoleToPos(this.PosToPole(t))}SortLines(){for(var t=0;t<this.linesOrdered.length;t++)this.linesOrdered[t].sort(((t,e)=>t.y1-e.y1))}SetBounds(){this.cameras.main.setBounds(0,0,1280,this.playAreaMaxY),this.physics.world.setBounds(0,0,1280,this.playAreaMaxY)}SwipeCamera(){var t=this.input.activePointer;t.isDown&&(-1==this.lastY&&(this.lastY=t.y),this.Scroll(this.lastY-t.y),this.lastY=t.y)}Scroll(t){this.cameras.main.scrollY+=t,this.ScrollUIElements(t),this.currScroll+=t,this.currScroll=p.Clamp(this.currScroll,0,this.playAreaMaxY-this.screenSize[1])}ScrollUIElements(t){this.UIElements.forEach((e=>{this.ScrollOneUIElement(t,e.element,e.offset)}))}ScrollOneUIElement(t,e,i){null!=e&&(e.y+=t,e.y=p.Clamp(e.y,this.screenSize[1]-i,this.playAreaMaxY-i))}GetIndexOfNext(t,e,i,s=!1){if(-1==t)return-1;if(t>=this.linesOrdered.length)return-1;if(0==this.linesOrdered[t].length)return-1;for(var h=0;h<this.linesOrdered[t].length;h++)if(("left"==i?this.linesOrdered[t][h].y1:this.linesOrdered[t][h].y2)>e)return s?h-1:h;return s?this.linesOrdered[t].length-1:-1}GeneratePath(t){var e=Array();e.push({x:this.PoleToPos(t),y:this.poleYSpacer});for(var i=t,s=0,h=0;s<this.playAreaMaxY;){if(++h>50){console.log("overloop");break}var r=this.GetIndexOfNext(i-1,s,"right"),a=this.GetIndexOfNext(i,s,"left");if(-1==r&&-1==a)break;var o=0;if(-1==r?o=2:-1==a&&(o=1),0==o){var l=this.linesOrdered[i-1][r],n=this.linesOrdered[i][a];o=l.y2>n.y1?2:1}else 1==o?l=this.linesOrdered[i-1][r]:n=this.linesOrdered[i][a];1==o?(e.push({x:this.PoleToPos(i),y:l.y2}),i--,e.push({x:this.PoleToPos(i),y:l.y1}),s=l.y1):(e.push({x:this.PoleToPos(i),y:n.y1}),i++,e.push({x:this.PoleToPos(i),y:n.y2}),s=n.y2)}return e.push({x:this.PoleToPos(i),y:this.playAreaMaxY-this.poleYSpacer}),e}StrokePath(t){for(var e,i=this.colGreen,s=0;s<t.length-1;s++){var h=this.add.line(0,0,t[s].x,t[s].y,t[s+1].x,t[s+1].y,i).setOrigin(0,0).setLineWidth(this.lineWidth);null===(e=this.traceDrawn)||void 0===e||e.add(h)}}SetStartPole(t=-1){var e;-1==t&&(t=Phaser.Math.Between(0,this.polesCount-1)),this.startPole=t;var i=this.startPole,s=this.add.line(0,0,this.PoleToPos(i),this.poleYSpacer,this.PoleToPos(i),this.poleYSpacer+this.lineYSpacer,this.colGreen).setOrigin(0,0).setLineWidth(this.lineWidth);null===(e=this.traceDrawn)||void 0===e||e.add(s)}SwipeErase(){var t=this.input.activePointer;if(t.isDown)for(var e=t.x,i=t.y+this.currScroll,s=this.linesOrdered,h=0;h<s.length;h++)for(var r=0;r<s[h].length;r++){var a=s[h][r],o=this.PoleToPos(a.poleInd),l=this.PoleToPos(a.poleInd+1),n=Math.min(a.y1,a.y2)-8,d=Math.max(a.y1,a.y2)+8;if(e>o&&e<l&&i>n&&i<d)return void s[h].splice(r,1)[0].drawn.destroy()}}StartDraw(t){var e={x:this.PosCorrectToPole(t.x),y:t.y+this.currScroll};this.lineInProgress={drawing:!0,checked:!1,drawn:this.add.line(0,0,e.x,e.y,e.x,e.y-50,this.colRed).setOrigin(0,0).setLineWidth(this.lineWidth).setDepth(10)}}SwipeDraw(){var t=this.input.activePointer,e=this.lineInProgress;if(null!=e&&e.drawing){var i=e.drawn,s=i.geom.x1,h=this.PosCorrectToPole(t.x),r=i.geom.y1,a=t.y+this.currScroll;i.setTo(s,r,h,a);var o=this.PosToPole(s),l=this.PosToPole(h);if(1!=Math.abs(o-l))return i.strokeColor=this.colRed,void(e.checked=!1);var n=o>l;e.y1=n?a:r,e.y2=n?r:a,e.poleInd=n?l:o,e.checked=this.ProposeLine(e.y1,e.y2,e.poleInd),e.checked?i.strokeColor=this.colGreen:i.strokeColor=this.colRed}}FinishDrawing(){var t,e=this.lineInProgress;null!=e&&(e.drawn.destroy(),e.checked)&&(this.CreateALine(e.y1,e.y2,e.poleInd),e.drawn=this.DrawLine(e),null===(t=this.linesDrawn)||void 0===t||t.clear(!0,!0),this.DrawLines(),this.SortLines())}ChangePolesCount(t){var e;t<2||(this.polesCount=t,this.RefreshLines(),null===(e=this.polesDrawn)||void 0===e||e.clear(!0,!0),this.DrawPoles())}InputMode(t){this.inputMode==t&&(t=-1),this.UIElementHighlight(t),this.inputMode=t,this.ResetTrace()}PointerDown(t){if(this.lastY=this.input.activePointer.y,-1==this.inputMode&&t.y<=this.poleYSpacer+this.lineYSpacer){this.ResetTrace(),this.SetStartPole(this.PosToPole(t.x));var e=this.GeneratePath(this.startPole);this.StrokePath(e)}this.inputMode==this.inputModes.draw&&this.StartDraw(t)}PointerHeld(){this.input.activePointer.isDown&&(-1==this.inputMode?this.SwipeCamera():this.inputMode==this.inputModes.erase&&this.SwipeErase(),this.inputMode==this.inputModes.draw&&this.SwipeDraw())}PointerMove(t){}PointerUp(t){this.inputMode==this.inputModes.draw&&this.FinishDrawing()}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.PointerHeld()}IndToPosSetup(t){this.itemSize=this.screenSize[t]/(this.iconsCount+1),this.itemSpacer=this.itemSize+10}IndToPos(t,e){var i=t-(this.iconsCount-1)/2,s=this.itemSpacer;return this.screenSize[e]/2+s*i}NextPhase(){switch(this.currentPhase++,this.currentPhase){case 0:this.RefreshLines(),this.HideScreen(!1);break;case 1:this.HideScreen(!0),this.SetStartPole(),this.Scroll(-this.playAreaMaxY);break;case 2:this.HideScreen(!1);var t=this.GeneratePath(this.startPole);this.StrokePath(t),this.currentPhase=-1}}RefreshLines(){this.ResetLines(),this.CreateLines(this.linesToGen),this.DrawLines(),this.SortLines()}HideScreen(t){var e=t?1:0;this.hideScreen.setAlpha(e)}}class g extends Phaser.Scene{constructor(){super({key:"PreloadGhostleg"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.image("random","assets/img/random.png"),this.load.image("draw","assets/img/draw.png"),this.load.image("erase","assets/img/erase.png"),this.load.image("plus","assets/img/plus.png"),this.load.image("minus","assets/img/minus.png")}create(){this.scene.start("MainGhostleg")}}class S extends Phaser.Scene{constructor(){super({key:"SceneSelect"}),this.boardSize={x:3,y:3}}create(){this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.CreateSSIconIndex(0,"jezzball","PreloadJezzball"),this.CreateSSIconIndex(1,"curveball","PreloadCurveball"),this.CreateSSIconIndex(2,"ghostleg","PreloadGhostleg"),this.CreateSSIconIndex(3,"othello","PreloadOthello"),this.CreateSSIconIndex(4,"burger","PreloadBurger"),this.CreateSSIconIndex(5,"alienbreak","PreloadAlienbreak"),this.CreateSSIconIndex(6,"bobbleSS","PreloadBobble"),this.CreateSSIconIndex(7,"snakeSS","PreloadSnake")}CreateSSIconIndex(t,e,i){var s=this.XToXY(t);this.CreateSSIconGrid(s.x,s.y,e,i)}XToXY(t){var e=this.boardSize.x;return{x:t%e,y:Math.floor(t/e)}}CreateSSIconGrid(t,e,i,s){var h=this.boardSize,r=this.BoardSpaceXY(h.x,h.y,t,e),a=this.add.image(r.x,r.y,i).setInteractive().setDepth(10).setDisplaySize(r.width,r.height);a.once("pointerup",(t=>{this.scene.start(s),a.destroy()}));var o=this.add.rectangle(r.x,r.y,r.width,r.height).setOrigin(.5,.5);o.isStroked=!0,o.strokeColor=0,o.lineWidth=2,o.depth=10}BoardSpaceXY(t,e,i,s){return p.BoardSpaceXY(this.screenSize,t,e,i,s,60,60)}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){}}class b extends Phaser.Scene{constructor(){super({key:"PreloadSceneSelect"})}preload(){var t="assets/img/sceneSelect/";this.load.image("ghostleg",t+"ghostleg.png"),this.load.image("curveball",t+"curveball.png"),this.load.image("jezzball",t+"jezzball.png"),this.load.image("othello",t+"othello.png"),this.load.image("burger",t+"burger.png"),this.load.image("alienbreak",t+"alienbreak.png"),this.load.image("bobbleSS",t+"bobble.png"),this.load.image("snakeSS",t+"snake.png")}create(){this.scene.start("SceneSelect")}}class m{}m.cols={green:58942,red:13699584,dullGreen:3438640,darkGreen:216320,pink:16273600,lightBlue:1628408,yellow:16316520,purple:11559160,orange:16298088,white:16777215,black:0};class y extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"ball"),this.name="tile",this.tileCodes={black:-1,white:1,empty:0},this.stableCodes={stable:1,unstable:-1,semi:0},this.stab=this.stableCodes.unstable,this.unstableToCol={black:0,white:0},this.tileNum="___",this.transparent=.02,t.add.existing(this),this.SetCol(this.tileCodes.empty)}update(){super.update}SetPosition(t,e){this.gridPos={x:t,y:e}}SetInvis(t=!0){this.invis=t,this.SetAlpha()}SetCol(t){var e=this.tileCodes;switch(this.tileCol=t,t){case e.black:this.setTint(0),this.SetAlpha(1);break;case e.white:this.setTint(16777215),this.SetAlpha(1);break;case e.empty:this.SetStab(this.stableCodes.unstable),this.SetAlpha(this.transparent)}}SetAlpha(t=0){this.invis?(this.setAlpha(0),this.visible=!1):(this.visible=!0,this.setAlpha(t))}SetValid(t){t?this.setAlpha(.02):this.SetAlpha(this.transparent)}SetStab(t){this.stab=t}SetSize(t,e){this.setSize(t,e),this.setDisplaySize(t,e)}}class v extends Phaser.Scene{constructor(){super({key:"MainOthello"}),this.boardSize={x:8,y:8},this.cpusEnabled={black:!1,white:!0},this.vsRand=!1,this.cpuVSPlayer=this.cpusEnabled.black!=this.cpusEnabled.white,this.scrambleCPUOnStart=!0,this.CPUDelayAction=this.cpuVSPlayer,this.trainingInProgress=this.cpusEnabled.black&&this.cpusEnabled.white,this.gamesTraining=10,this.driftMax=.1,this.wildWeightsChance=0,this.wildCutoffPct=.75,this.cpuWeights={frontiers:this.QECSW(.5,.3,1,1),emptyAdjUnique:this.QECSW(.2,.2,1,1),emptyAdjSum:this.QECSW(.2,.2,1,1),legalMoves:this.QECSW(.65,.5,1,1),stablesWt:this.QECSW(.7,.35,1,1),unstableTileSum:this.QECSW(.25,.4,1,1),unstableTileUnique:this.QECSW(.4,.3,1,1)},this.cLog={eachGameResult:!1,debugStableOnGame:!1,reportCPUWeights:!1,reportTrainEnding:!0,bestScoreEveryEval:!1,debugStableOnFlips:!1,debugStablePerTile:!1,stopOnFirstCorner:!1},this.scoreAvg=0,this.scoreEvalCount=0,this.devModeCheats=!0,this.tileCodes={black:-1,white:1,empty:0},this.turn=-1,this.tilesSet=0,this.tilesMax=this.boardSize.x*this.boardSize.y,this.lastTurnPassed=!1,this.stableCodes={stable:1,unstable:-1,semi:0},this.newStables=0,this.simNewStables=0,this.totalStables=0,this.stableRetCodes={border:0,stableSameCol:1,empty:2},this.simTileCounts={x:Array(),y:Array(),w:Array(),z:Array()},this.tileCounts={x:Array(),y:Array(),w:Array(),z:Array()},this.tileCountsMax={straight:this.boardSize.x,diag:Array()},this.gamesCount=0,this.wentFirst=this.tileCodes.white,this.playerMovedThisGame=!1,this.winRate={black:0,white:0}}create(){this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.groupTiles=this.physics.add.staticGroup({defaultKey:"tile",classType:y}),this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)})),this.tiles=p.Init2DArray(this.boardSize.x,this.boardSize.y),this.simTiles=p.Init2DArray(this.boardSize.x,this.boardSize.y),this.prevTurnTiles=p.Init2DArray(this.boardSize.x,this.boardSize.y),this.DrawBoard_CreateTiles();var t=this.boardSize;var e={x:0==this.smallerDim?(t.x-1)/2:t.x+1.2-1,y:1==this.smallerDim?(t.y-1)/2:t.y+1.2-1},i=this.BoardSpaceXY(e.x,e.y);this.turnIndicator=this.CreateTile(i.x,i.y,i.width,i.height,-1,-1,"ui"),(this.cpusEnabled.white||this.cpusEnabled.black)&&this.turnIndicator.SetInvis();var s={x:0==this.smallerDim?(t.x-1)/2:-1.2,y:1==this.smallerDim?(t.y-1)/2:-1.2};i=this.BoardSpaceXY(s.x,s.y),this.winIndicator=this.CreateTile(i.x,i.y,i.width,i.height,-1,-1,"ui"),this.winIndicator.on("pointerup",(t=>{this.trainingInProgress||this.Restart()}));var h={x:0==this.smallerDim?(t.x-1)/4:-1.2,y:1==this.smallerDim?(t.y-1)/4:-1.2};i=this.BoardSpaceXY(h.x,h.y),this.undoButton=this.add.image(i.x,i.y,"undo").setInteractive().setDepth(10).setScale(i.width/64),this.undoButton.on("pointerup",(t=>{this.UndoTurn()})),this.scrambleCPUOnStart&&(this.cpusEnabled.white&&this.ScrambleWeights(this.tileCodes.white),this.cpusEnabled.black&&this.ScrambleWeights(this.tileCodes.black)),this.SetTurn(this.tileCodes.black),this.Restart()}DrawBoard_CreateTiles(){var t=this.screenSize[0]>this.screenSize[1]?1:0;this.smallerDim=t;var e=this.screenSize[t],i=this.screenSize[0==t?1:0];this.add.rectangle(this.screenSize[0]/2,this.screenSize[1]/2,e,e,m.cols.dullGreen).setDepth(-10).setOrigin(.5,.5);var s={x:0==t?0:(i-e)/2,y:1==t?1:(i-e)/2};this.boardOffset=s;var h=e/75,r=e/75;this.boardOffset.innerSideSpace=h;for(var a=0;a<this.boardSize.x;a++)for(var o=this.BoardSpaceX(a,s.x,h),l=0;l<this.boardSize.y;l++){var n=this.BoardSpaceY(l,s.y,h);this.DrawRect(o.pos,n.pos,o.size,n.size),this.CreateTile(o.pos,n.pos,o.size-r,n.size-r,a,l,"board"),this.CreateTile(o.pos,n.pos,o.size-r,n.size-r,a,l,"sim")}}DrawRect(t,e,i,s){var h=this.add.rectangle(t,e,i,s).setOrigin(.5,.5);return h.isStroked=!0,h.strokeColor=m.cols.darkGreen,h}BoardSpaceX(t,e,i){return p.LayoutSpace(t,this.boardSize.x,this.screenSize[0],0,e,i)}BoardSpaceY(t,e,i){return p.LayoutSpace(t,this.boardSize.y,this.screenSize[1],0,e,i)}BoardSpaceXY(t,e){var i=this.boardOffset,s=this.BoardSpaceX(t,i.x,i.innerSideSpace),h=this.BoardSpaceY(e,i.y,i.innerSideSpace);return{x:s.pos,y:h.pos,width:s.size,height:h.size}}SetStartTiles(){var t=this.tileCodes,e=this.boardSize,i=e.x/2,s=e.y/2;this.SetTile(i-1,s-1,t.white,!1,!1),this.SetTile(i,s,t.white,!1,!1),this.SetTile(i,s-1,t.black,!1,!1),this.SetTile(i-1,s,t.black,!1,!1)}CreateTile(t,e,i,s,h=-1,r=-1,a="null"){var o,l=new y(this,t,e);return l.setOrigin(.5,.5),l.setDepth("sim"==a?-1:10),l.setInteractive(),null===(o=this.groupTiles)||void 0===o||o.add(l),l.SetSize(i,s),l.gridPos={x:h,y:r},"board"==a?(this.tiles[h][r]=l,l.on("pointerup",(t=>{this.TileClicked(l)}))):"sim"==a&&(this.simTiles[h][r]=l,l.SetInvis()),l}TileClicked(t){if(!this.trainingInProgress&&(this.turn!=this.tileCodes.black||!this.cpusEnabled.black)&&(this.turn!=this.tileCodes.white||!this.cpusEnabled.white)&&t.tileCol==this.tileCodes.empty&&this.CheckValid(t,this.turn)){this.playerMovedThisGame=!0,this.cpuVSPlayer&&this.SaveTurn();var e=t.gridPos;this.SetTile(e.x,e.y,this.turn)}}SetTile(t,e,i,s=!0,h=!0){var r=this.simTiles;if(this.sim||(r=this.tiles),this.sim||(this.tilesSet++,r[t][e].tileNum="",this.tilesSet<10&&(r[t][e].tileNum="_"),r[t][e].tileNum+=this.tilesSet,i==this.tileCodes.black&&(r[t][e].tileNum+="B"),i==this.tileCodes.white&&(r[t][e].tileNum+="W")),r[t][e].SetCol(i),this.AddToTileCounts(t,e),s&&(this.newStables=0,this.FlipStart(t,e,i,!1)),this.CheckSetStable(t,e),!this.sim&&this.cLog.stopOnFirstCorner&&this.IsCorner(t,e))throw this.DebugStable(this.tiles),"stop";!this.sim&&this.cLog.debugStablePerTile&&this.DebugStable(this.tiles),h&&this.SetTurn()}SetTurn(t=-10,e=-10){var i=this.tileCodes;if(this.validMoves=this.CheckAllValid(this.Opp()),-10!=e&&(this.validMoves=this.CheckAllValid(e)),-10!=t)this.turn=t;else if(0!=this.validMoves.length)this.turn=this.turn==i.black?i.white:i.black,this.PerformCPUTurn();else{if(0==this.CheckAllValid(this.turn).length)return void this.GameOver();this.CheckCPUTurn()&&(this.turn=this.turn==i.black?i.white:i.black,this.SetTurn())}this.turnIndicator.SetCol(this.turn)}PointerDown(t){}PointerHeld(){}PointerMove(t){}PointerUp(t){}CheckAllValid(t){var e=this.simTiles;this.sim||(e=this.tiles);for(var i=Array(),s=0;s<this.boardSize.x;s++)for(var h=0;h<this.boardSize.y;h++)if(e[s][h].tileCol==this.tileCodes.empty){var r=this.FlipStart(s,h,t,!0);e[s][h].SetValid(r>0),r>0&&i.push({x:s,y:h,flipped:r})}return i}CheckValid(t,e){return this.FlipStart(t.gridPos.x,t.gridPos.y,e,!0)}FlipStart(t,e,i,s=!1){var h=this.simTiles;if(this.sim||(h=this.tiles),s&&h[t][e].tileCol!=this.tileCodes.empty)return 0;var r=0;this.tilesFlipped=Array();for(var a=-1;a<=1;a++)for(var o=-1;o<=1;o++)if(0!=a||0!=o){var l=this.FlipRecurs(t+a,e+o,a,o,i,s,0);if(r+=l,s&&l)return l}return!s&&this.cLog.debugStableOnFlips&&this.DebugStable(this.tiles),r}FlipRecurs(t,e,i,s,h,r,a){var o=this.simTiles;if(this.sim||(o=this.tiles),p.OOB(t,this.boardSize.x)||p.OOB(e,this.boardSize.y))return!1;if(o[t][e].tileCol==this.tileCodes.empty)return!1;if(o[t][e].tileCol==h)return a>0&&a;var l=this.FlipRecurs(t+i,e+s,i,s,h,r,a+1);return l&&r&&this.tilesFlipped.push(o[t][e]),l&&!r&&o[t][e].SetCol(h),l}CheckSetStable(t,e){for(var i=[[-1,-1],[1,1],[1,-1],[-1,1],[-1,0],[1,0],[0,-1],[0,1]],s=0;s<i.length;s++)this.CheckStablePropogHelp(t,e,i[s])}CheckStablePropogHelp(t,e,i){var s=this.tileCodes,h=this.simTiles;this.sim||(h=this.tiles);var r=t,a=e;for(this.CheckStableTile(t,e);;){if(r+=i[0],a+=i[1],p.OOB(r,this.boardSize.x)||p.OOB(a,this.boardSize.y))return;if(h[r][a].tileCol==s.empty)return;this.CheckStableTile(r,a)}}CheckStableTile(t,e){var i=this.simTiles;if(this.sim||(i=this.tiles),i[t][e].stab==this.stableCodes.stable)return!0;if(i[t][e].tileCol==this.tileCodes.empty&&!this.sim)return!1;this.sim&&(this.ResetSim(!0),this.AddToTileCounts(t,e));for(var s=[[[-1,-1],[1,1]],[[1,-1],[-1,1]],[[-1,0],[1,0]],[[0,-1],[0,1]]],h=["w","z","x","y"],r=0;r<s.length;r++)if(!this.CheckStablePair(i,t,e,s[r],h[r]))return!1;return i[t][e].SetStab(this.stableCodes.stable),this.sim&&this.simNewStables++,this.subSim||this.newStables++,this.sim||this.totalStables++,!0}CheckStablePair(t,e,i,s,h){if(this.CheckSpecificLineFull(e,i,h))return!0;var r=this.stableRetCodes,a=this.CheckStableInDir(t,e,i,s[0]),o=this.CheckStableInDir(t,e,i,s[1]);return a==r.border||o==r.border||a==r.stableSameCol||o==r.stableSameCol}CheckStableInDir(t,e,i,s){var h=this.tileCodes,r=this.stableCodes,a=this.stableRetCodes,o=e,l=i;if(o+=s[0],l+=s[1],p.OOB(o,this.boardSize.x)||p.OOB(l,this.boardSize.y))return a.border;var n=t[o][l];return n.tileCol==t[e][i].tileCol&&n.stab==r.stable?a.stableSameCol:n.tileCol==h.empty?a.empty:void 0}DebugStable(t){this.DebugBoard(t,"stable")}DebugBoard(t,e="stable"){for(var i=this.stableCodes,s=this.tileCodes,h=Array(),r=Array(),a=0;a<t[0].length;a++){h=Array();for(var o=0;o<t.length;o++){var l="_";"col"==e?(t[o][a].tileCol==s.black&&(l="B"),t[o][a].tileCol==s.white&&(l="W")):"stable"==e?(t[o][a].stab==i.stable&&(l="S"),t[o][a].stab==i.semi&&(l="/")):"tileNum"==e?l=t[o][a].tileNum:console.log("WARN: WRONG MODE"),h.push(l)}r.push(h)}console.log(r)}InitTileCounts(){this.simTileCounts={x:Array(),y:Array(),w:Array(),z:Array()},this.tileCounts={x:Array(),y:Array(),w:Array(),z:Array()},this.InitTC("real"),this.InitTC("sim")}InitTC(t){var e;"real"==t&&(e=this.tileCounts),"sim"==t&&(e=this.simTileCounts);var i=this.boardSize;e.x=Array.from({length:i.x},((t,e)=>0)),e.y=Array.from({length:i.y},((t,e)=>0)),i.x!=i.y&&console.log("WARN: ASSUMPTION OF SQUARE BOARD FAILED");var s=2*i.x-1;e.w=Array.from({length:s},((t,e)=>0)),e.z=Array.from({length:s},((t,e)=>0)),this.tileCountsMax.diag=Array.from({length:s},((t,e)=>e<i.x?e+1:s-e))}AddToTileCounts(t,e){var i=this.simTileCounts;this.sim||(i=this.tileCounts),i.x[t]++,i.y[e]++;var s=this.XYtoWZ(t,e);i.w[s.w]++,i.z[s.z]++}CSLSALL(){for(var t=0;t<8;t++)for(var e=0;e<8;e++){var i=this.XYtoWZ(t,e);this.CheckSetLineStable(t,e,i.w,i.z)&&console.log(!0)}}CheckSetLineStable(t,e,i,s){var h=this.simTileCounts;this.sim||(h=this.tileCounts);var r=this.tileCountsMax;return h.x[t]==r.straight&&h.y[e]==r.straight&&h.w[i]==r.diag[i]&&h.z[s]==r.diag[s]}CheckSpecificLineFull(t,e,i){this.XYtoWZ(t,e);var s=this.tileCountsMax.straight;"w"!=i&&"z"!=i||(s=this.tileCountsMax.diag[i]);var h=this.simTileCounts;return this.sim||(h=this.tileCounts),h[i][i]==s}XYtoWZ(t,e){return{w:t+e,z:Math.abs(e-t-this.boardSize.x+1)}}GameOver(){for(var t,e={white:0,black:0},i=this.tiles,s=this.tileCodes,h=0;h<this.boardSize.x;h++)for(var r=0;r<this.boardSize.y;r++)i[h][r]!=s.empty&&(i[h][r].tileCol==s.white?e.white++:e.black++);if(e.white==e.black?t=s.empty:((t=e.white>e.black?s.white:s.black)==s.white?this.winRate.white++:this.winRate.black++,this.winIndicator.SetInvis(!1),this.winIndicator.SetCol(t)),this.cLog.eachGameResult&&console.log("game over",e,this.ColToString(t),"win","scoreAvg",this.scoreAvg/this.scoreEvalCount),this.cLog.reportCPUWeights)for(const[t,e]of Object.entries(this.cpuWeights))console.log(t,e);this.cLog.debugStableOnGame&&this.DebugStable(this.tiles),this.ScrambleWeights(this.Opp(t)),this.gamesCount++;var a=this.cpusEnabled;if(a.white&&a.black){if(this.gamesCount>=this.gamesTraining)return void this.ReportEnding();this.Restart()}}Restart(){this.winIndicator.SetCol(this.tileCodes.empty);for(var t=0;t<this.boardSize.x;t++)for(var e=0;e<this.boardSize.y;e++)this.tiles[t][e].SetCol(this.tileCodes.empty),this.tiles[t][e].SetStab(this.stableCodes.unstable);this.InitTileCounts(),this.tilesSet=0,this.totalStables=0,this.SetStartTiles(),this.SaveTurn(),this.scoreAvg=0,this.scoreEvalCount=0,this.restartFlag=!0}RestartOnUpdate(){this.trainingInProgress?(this.wentFirst=this.Opp(this.wentFirst),this.SetTurn(this.wentFirst,this.wentFirst)):((0==this.gamesCount&&Phaser.Math.FloatBetween(0,1)<.5||0!=this.gamesCount&&this.cpuVSPlayer)&&(this.cpusEnabled.black=!this.cpusEnabled.black,this.cpusEnabled.white=!this.cpusEnabled.white),this.playerMovedThisGame=!1,this.SetTurn(this.tileCodes.black,this.tileCodes.black)),this.PerformCPUTurn()}ReportEnding(){this.cLog.reportTrainEnding&&(this.trainingInProgress=!1,this.cpusEnabled.black=!1,console.log("winrate",this.winRate,"ties",this.gamesTraining-this.winRate.white-this.winRate.black),console.log(this.cpuWeights))}DisableCPUOpp(){this.cpusEnabled.white=!1}PerformCPUTurn(){this.CheckCPUTurn()&&this.CPUTurn()}CheckCPUTurn(){var t=!1;return(this.cpusEnabled.white&&this.turn==this.tileCodes.white||this.cpusEnabled.black&&this.turn==this.tileCodes.black)&&(t=!0),t}CPUTurn(){this.sim=!0;for(var t,e=this.tileCodes,i=-1e4,s=this.validMoves,h=s[0],r=0;r<s.length;r++)this.subSim=!1,0,this.ResetSim(),this.SetTile(s[r].x,s[r].y,this.turn,!0,!1),this.subSim=!0,(t=this.vsRand&&this.turn==e.white?this.EvalSimBoardRand():this.EvalSimBoard())>i&&(i=t,h=s[r]);this.cLog.bestScoreEveryEval&&this.turn==e.white&&console.log(i),this.cLog.eachGameResult&&(this.scoreAvg+=i,this.scoreEvalCount++),this.sim=!1,this.CPUDelayAction?(this.bestMove=h,this.time.delayedCall(1e3,this.ResolveCPUAction,h,this)):this.SetTile(h.x,h.y,this.turn)}ResolveCPUAction(t){this.SetTile(this.bestMove.x,this.bestMove.y,this.turn)}ResetSim(t=!1){for(var e=this.stableCodes,i=0;i<this.boardSize.x;i++)for(var s=0;s<this.boardSize.y;s++){t||(this.simTiles[i][s].SetCol(this.tiles[i][s].tileCol),this.simTiles[i][s].unstableToCol={black:0,white:0}),this.simTiles[i][s].SetStab(this.tiles[i][s].stab==e.stable?e.stable:e.semi);var h=this.XYtoWZ(i,s),r=h.w,a=h.z;this.simTileCounts.x[i]=this.tileCounts.x[i],this.simTileCounts.y[s]=this.tileCounts.y[s],this.simTileCounts.w[r]=this.tileCounts.w[r],this.simTileCounts.z[a]=this.tileCounts.z[a]}}ScrambleWeights(t){this.tileCodes;var e,i=this.cpuWeights,s=this.ColToString(t),h=this.ColToString(this.Opp(t)),r=["me","opp"];for(const[t,c]of Object.entries(i))for(var a in r){var o=r[a],l=c;e=this.vsRand?l[s][o]:l[h][o];var n,d=this.driftMax;n=this.gamesCount/this.gamesTraining<=this.wildCutoffPct&&Phaser.Math.FloatBetween(0,1)<=this.wildWeightsChance?Phaser.Math.FloatBetween(0,1):Phaser.Math.FloatBetween(e-d,e+d),n=p.Clamp(n,0,1),l[s][o]=n}}QECSW(t,e,i,s){return{white:{me:t,opp:e,meTime:i,oppTime:s},black:{me:t,opp:e,meTime:i,oppTime:s}}}PairedEvalConstructor(t=0){return{white:t,black:t}}EvalSimBoard(){return this.EvalSimBoardBest()}EvalSimBoardRand(){return Phaser.Math.FloatBetween(0,1)}EvalSimBoardBest(){var t=this.tileCodes,e=this.simTiles;this.simNewStables=0;for(var i=this.PairedEvalConstructor(),s=this.PairedEvalConstructor(),h=this.PairedEvalConstructor(),r=this.PairedEvalConstructor(),a=0;a<this.boardSize.x;a++)for(var o=0;o<this.boardSize.y;o++){for(var l={black:!1,white:!1,empty:!1},n=-1;n<=1;n++)for(var d=-1;d<=1;d++)if(0!=n||0!=d){var c=a+n,u=o+d;if(!p.OOB(c,e.length)&&!p.OOB(u,e[0].length)){var g=e[a][o].tileCol,S=e[c][u].tileCol;S==t.empty&&(l.empty=!0),S==t.white&&(l.white=!0),S==t.black&&(l.black=!0),S==t.empty&&(g==t.white&&h.white++,g==t.black&&h.black++)}}g==t.empty&&(l.white&&s.white++,l.black&&s.black++),g!=t.empty&&l.empty&&(g==t.white?i.white++:i.black++),this.CheckValid(e[a][o],t.white)&&(this.MarkTilesUnstable(this.tilesFlipped,"white"),r.white++,t.white==this.Opp()&&this.CheckSetStable(a,o)),this.CheckValid(e[a][o],t.black)&&(this.MarkTilesUnstable(this.tilesFlipped,"black"),r.black++,t.black==this.Opp()&&this.CheckSetStable(a,o))}var b=this.PairedEvalConstructor(),m=this.PairedEvalConstructor();for(a=0;a<this.boardSize.x;a++)for(o=0;o<this.boardSize.y;o++){var y=e[a][o].unstableToCol.black,v=e[a][o].unstableToCol.white;y&&v&&console.log("HWAT"),y&&b.white++,v&&b.black++,m.white+=y,m.black+=v}var C,w=this.cpuWeights,x=0;return C=this.turn==this.tileCodes.black?{black:this.newStables,white:this.simNewStables}:{white:this.newStables,black:this.simNewStables},this.WeightValPair(C,w.stablesWt),this.tilesSetPercent=this.tilesSet/this.tilesMax,x+=this.WeightValPair(C,w.stablesWt),x-=this.WeightSumPair(m,w.unstableTileSum),x-=this.WeightValPair(b,w.unstableTileUnique),x+=this.WeightValPair(r,w.legalMoves),x-=this.WeightValPair(i,w.frontiers),(x-=this.WeightValPair(s,w.emptyAdjUnique))-this.WeightSumPair(h,w.emptyAdjSum)}WeightValPair(t,e){var i=this.ColToString(this.turn),s=this.ColToString(this.Opp()),h=(this.tilesSetPercent,t[i]*e[i].me),r=t[s]*e[i].opp;return this.CompareVals(h,r)}CompareVals(t,e){return t+e==0?0:(t-e)/(t+e)}MarkTilesUnstable(t,e){for(var i=0;i<t.length;i++)t[i].gridPos,t[i].SetStab(this.stableCodes.unstable),t[i].unstableToCol[e]++}WeightSumPair(t,e){return this.SumScorePenalize(this.WeightValPair(t,e))}SumScorePenalize(t){return.2*t}Opp(t=-10){var e=this.tileCodes;return(-10==t?this.turn:t)==e.white?e.black:e.white}ColToString(t){return t==this.tileCodes.white?"white":"black"}IsCorner(t,e){var i=this.boardSize;return!(0!=t&&t!=i.x-1||0!=e&&e!=i.y-1)}SaveTurn(){for(var t=this.boardSize,e=0;e<t.x;e++)for(var i=0;i<t.y;i++)this.prevTurnTiles[e][i]=this.tiles[e][i].tileCol}UndoTurn(){if(console.log(this.prevTurnTiles),(this.turn!=this.tileCodes.black||!this.cpusEnabled.black)&&(this.turn!=this.tileCodes.white||!this.cpusEnabled.white)&&this.cpuVSPlayer&&this.playerMovedThisGame)for(var t=this.boardSize,e=0;e<t.x;e++)for(var i=0;i<t.y;i++)this.tiles[e][i].SetCol(this.prevTurnTiles[e][i])}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.PointerHeld(),this.restartFlag&&(this.restartFlag=!1,this.RestartOnUpdate())}}class C extends Phaser.Scene{constructor(){super({key:"PreloadOthello"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.image("ball","assets/img/ball.png"),this.load.image("undo","assets/img/undo.png")}create(){this.scene.start("MainOthello")}}class w extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"girl"),this.name="girl",this.left=!0,this.right=!0,this.wrongCatchAnim=!1,this.goodCatchAnim=!1,t.add.existing(this)}update(){super.update}SetSize(t,e){this.setDisplaySize(t,e)}SetAnim(t,e){var i;this.left=t,this.right=e,t&&e&&(i=0),!t&&e&&(i=1),t&&!e&&(i=2),t||e||(i=3),this.wrongCatchAnim?this.setTexture("girlScowl"):this.goodCatchAnim?this.setTexture("girlSmile"):this.setTexture("girl"),this.setFrame(i.toString())}SetWrongCatch(t){this.wrongCatchAnim=t,this.SetAnim(this.left,this.right)}SetGoodCatch(t){this.goodCatchAnim=t,this.SetAnim(this.left,this.right)}}class x extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"ingred"),this.name="ingred",this.placed=!1,t.add.existing(this)}update(){super.update}SetSize(t,e){this.setDisplaySize(t,e)}}class f extends Phaser.Scene{constructor(){super({key:"MainBurger"}),this.devModeCheats=!0,this.debug={hitAreas:!1,dropZone:!1,dropItemAtStart:!1,dropBurgerAtStart:!1,suppressStart:!1},this.cLog={livesOnLoss:!1,ingredLanded:!1,badCatch:!1,levels:!1},this.spriteAspectRatio=1.8,this.hitAreas=Array(),this.debugRects=Array(),this.inputBoxCount=4,this.dropZonesInit=[.15,.78,2.24,2.87],this.dropZonesBSXY=Array(),this.ingredAspectRatio=2.55,this.burgerTopAspectRatio=1.847,this.left=!0,this.right=!0,this.moveDist=50,this.burgerStackYBase=1e4,this.burgerStackCount={L:0,R:0},this.burgerStackQuality={L:!0,R:!1},this.ingredSpeed={L:1,R:1},this.ingredStackMax={L:1,R:1},this.ingredSpeedScaling=0,this.ingredSpeedBase=5e-4,this.ingredSpeedVary={min:3e-4,max:5e-4},this.ingredSpeedPerLevel=1e-4,this.burgerCurrentlySpawning={L:!1,R:!1},this.lastIngred={L:-1,R:-1},this.activeIngredients={L:Array(),R:Array()},this.level=0,this.lives=1,this.bestLevel=0,this.wrongAnimTime=3e3,this.goodAnimTime=3e3,this.LR=["L","R"]}create(){this.input.addPointer(1),this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)})),this.CreateObjs(),this.CreateHitAreas(),this.SetDropZone(),this.PreparePartsBSXY(),this.CreateUI(),this.DebugDropAnItem(),this.DebugDropABurger()}CreateObjs(){var t,e;this.groupObj=this.physics.add.staticGroup({defaultKey:"tile"});var i=this.spriteAspectRatio,s=p.BoardSpaceXY(this.screenSize,1,i,0,.88),h=new w(this,s.x,s.y);h.setOrigin(.5,.5),h.setDepth(1),this.girl=h,null===(t=this.groupObj)||void 0===t||t.add(h),h.SetSize(s.width,s.height),this.burgerStackYBase=s.y,s=p.BoardSpaceXY(this.screenSize,1,i,0,0);var r=this.add.image(s.x,s.y,"bg");r.setOrigin(.5,.5),r.setDepth(1),null===(e=this.groupObj)||void 0===e||e.add(r),r.setDisplaySize(s.width,s.height),this.ingredSpeedScaling=s.height}CreateHitAreas(){for(var t=0;t<this.inputBoxCount;t++){var e=p.BoardSpaceXY(this.screenSize,this.inputBoxCount,1,t-.5,-.5,100,300),i=e.x,s=e.y,h=e.width,r=e.height,a=new Phaser.Geom.Rectangle(i,s,h,r),o=this.add.rectangle(i,s,h,r).setDepth(-10).setOrigin(0,0).setDepth(2);o.isStroked=this.debug.hitAreas,o.strokeColor=m.cols.white,this.debugRects.push(o),this.hitAreas.push(a)}}SetDropZone(){for(var t=this.dropZonesInit,e=0;e<t.length;e++){var i=p.BoardSpaceXY(this.screenSize,this.inputBoxCount,3,t[e],-.5,100,300);this.dropZonesBSXY.push(i)}this.DebugDropZone()}PreparePartsBSXY(){var t=this.inputBoxCount;this.ingredBSXY=p.BoardSpaceXY(this.screenSize,t,t*this.ingredAspectRatio,0,-.5),this.burgerTopBSXY=p.BoardSpaceXY(this.screenSize,t,t*this.burgerTopAspectRatio,0,-.5),this.ingredBSXY.width*=1.24,this.ingredBSXY.height*=1.24,this.burgerTopBSXY.width*=1.24,this.burgerTopBSXY.height*=1.24,this.moveDist=this.ingredBSXY.width/1.9}CheckPointerInBounds(t,e){var i=this.hitAreas[e];if(p.PointWithinBounds(t,i)&&(this.PointerInArea(e),this.debug.hitAreas)){this.debugRects[e].strokeColor=m.cols.green;var s=0;0==e&&(s=1),1==e&&(s=0),2==e&&(s=3),3==e&&(s=2),this.debugRects[s].strokeColor=m.cols.white}}PointerDown(t){for(var e=0;e<2;e++)this.CheckPointerInBounds(t,e);for(e=2;e<4;e++)this.CheckPointerInBounds(t,e)}PointerHeld(){for(var t=0;t<3;t++)this.PointerHeldIterate(t)}PointerHeldIterate(t){var e=this.input.manager.pointers[t];e.noButtonDown()||this.PointerDown(e)}PointerMove(t){}PointerUp(t){}PointerInArea(t){this.ZMismatch(t)&&this.MoveBurger(t),0==t&&(this.left=!0),1==t&&(this.left=!1),2==t&&(this.right=!1),3==t&&(this.right=!0),this.girl.SetAnim(this.left,this.right),this.CheckStartGame()}MoveBurger(t){for(var e=this.ColToLRI(t),i=1==t||3==t,s=this.activeIngredients,h=0;h<s[e].length;h++){var r=s[e][h];r.placed&&(i?r.x+=this.moveDist:r.x-=this.moveDist)}}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.PointerHeld(),this.UpdateIngredPositions(e)}UpdateIngredPositions(t){for(var e=this.activeIngredients,i=this.ingredBSXY.height/3,s=0;s<this.LR.length;s++)for(var h=this.LR[s],r=0;r<e[h].length;r++){var a=this.burgerStackYBase-i*this.burgerStackCount[h],o=e[h][r],l=o.velocity*t;o.placed||(o.y+l>a?(this.burgerStackCount[h]++,o.y=a,o.placed=!0,o.velocity=0,this.cLog.ingredLanded&&console.log("landed"),this.IngredLanded(o)):o.y=o.y+o.velocity*t)}}IngredLanded(t){var e=t.column,i=this.ColToLRI(e);this.ZMismatch(e)?(this.cLog.badCatch&&console.log("badcatch"),this.SetAnimBadCatch(),this.burgerStackQuality[i]&&(this.SubtractLife(),this.burgerStackQuality[i]=!1)):this.burgerStackQuality[i]&&this.ingredStackMax[i]+1==this.burgerStackCount[i]&&(this.SetLevel(),this.SetAnimGoodCatch())}SpawnBurger(t){if(this.gameStarted)if(this.burgerCurrentlySpawning[t])console.log("WARN: DUPE SPAWN; CAUGHT");else{this.burgerCurrentlySpawning[t]=!0,this.ingredSpeed[t]=(this.ingredSpeedBase+this.ingredSpeedPerLevel*this.level+Phaser.Math.FloatBetween(this.ingredSpeedVary.min,this.ingredSpeedVary.max))*this.ingredSpeedScaling,this.burgerStackQuality[t]=!0;var e=4+Math.floor(this.level/2);this.ingredStackMax[t]=e,this.time.addEvent({delay:500,callback:this.FormatIngred,args:[t],callbackScope:this,repeat:e-1}),this.time.delayedCall(500*(e+1),this.FormatTop,[t],this),this.time.delayedCall(500*(e+8),this.ResolveBurger,[t],this)}}FormatIngred(t){var e=this.LRIToCol(t),i=this.level;i=p.Clamp(this.level+2,0,7);var s=Phaser.Math.Between(0,i);s==this.lastIngred[t]&&(s=Phaser.Math.Between(0,i)),this.lastIngred[t]=s,this.SpawnIngredient(e,s)}FormatTop(t){var e=this.LRIToCol(t);this.SpawnTop(e)}SpawnIngredient(t,e){e>=8&&console.log("OUT OF INDEX");var i=this.dropZonesBSXY[t],s=new x(this,i.x,i.y);s.setFrame(e);var h=this.ingredBSXY;s.setDisplaySize(h.width,h.height),this.SpawnIngredHelper(t,s)}SpawnTop(t){var e=this.dropZonesBSXY[t],i=new x(this,e.x,e.y);i.setTexture("burgerTop");var s=this.burgerTopBSXY;i.setDisplaySize(s.width,s.height),this.SpawnIngredHelper(t,i)}SpawnIngredHelper(t,e){e.setDepth(3).setOrigin(.5,.5),e.column=t;var i=this.ColToLRI(t);this.activeIngredients[i].push(e),e.velocity=this.ingredSpeed[i]}ResolveBurger(t){for(var e=this.activeIngredients[t],i=e.length-1;i>=0;i--)e[i].destroy();this.burgerStackCount[t]=0,this.burgerCurrentlySpawning[t]=!1;var s=Phaser.Math.Between(4500,5700);s-=400*this.level,s=p.Clamp(s,500,1e6),this.time.delayedCall(s,this.SpawnBurger,[t],this)}CheckStartGame(){if(!this.gameStarted){for(var t=0;t<this.LR.length;t++){var e=this.LR[e];if(this.burgerCurrentlySpawning[e])return}if(this.gameStarted=!0,this.SetLevel(0),!this.debug.suppressStart){var i=1==Phaser.Math.Between(0,1);this.time.delayedCall(i?500:5e3,this.SpawnBurger,["L"],this),this.time.delayedCall(i?5e3:500,this.SpawnBurger,["R"],this)}}}SetLevel(t=-1){-1==t&&(t=this.level+1),this.level=t,0==t&&(this.lives=2),t%2&&(this.lives=this.lives+1),this.bestLevel<t&&(this.bestLevel=t),this.level=t,this.cLog.levels&&console.log("lvl",this.level,this.bestLevel),this.UpdateLevelUI()}SubtractLife(){this.lives--,this.cLog.livesOnLoss&&console.log(this.lives),this.lives<=0&&(this.SetLevel(0),this.gameStarted=!1)}CreateUI(){var t=this.CreateText();this.currLevelText=t;var e=this.CreateText();this.bestLevelText=e;var i=this.CreateImage("burgerUI"),s=this.CreateImage("crownUI");t.setOrigin(0,.5),e.setOrigin(1,.5),this.SetBSXY(i,p.BoardSpaceXY(this.screenSize,10,10,0,9)),this.SetBSXY(s,p.BoardSpaceXY(this.screenSize,10,10,9,9)),this.SetBSXY(t,p.BoardSpaceXY(this.screenSize,10,10,.5,9),!1),this.SetBSXY(e,p.BoardSpaceXY(this.screenSize,10,10,8.5,9),!1)}SetBSXY(t,e,i=!0){t.setPosition(e.x,e.y),i&&t.setDisplaySize(e.width,e.height)}CreateText(){return this.add.text(0,0,"0",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',fontSize:"40px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10)}CreateImage(t){var e=this.add.image(0,0,t);return e.setOrigin(.5,.5).setDepth(10),e}UpdateLevelUI(){this.currLevelText.setText(this.level),this.bestLevelText.setText(this.bestLevel)}SetAnimBadCatch(){this.girl.SetWrongCatch(!0),this.lastWrong=this.time.now,this.time.delayedCall(this.wrongAnimTime,this.ResolveAnimBadCatch,[],this)}ResolveAnimBadCatch(){this.lastWrong>this.time.now-this.wrongAnimTime+100||this.girl.SetWrongCatch(!1)}SetAnimGoodCatch(){this.girl.SetGoodCatch(!0),this.lastGood=this.time.now,this.time.delayedCall(this.goodAnimTime,this.ResolveAnimGoodCatch,[],this)}ResolveAnimGoodCatch(){this.lastGood>this.time.now-this.goodAnimTime+100||this.girl.SetGoodCatch(!1)}DebugDropZone(){if(this.debug.dropZone)for(var t=this.dropZonesInit,e=0;e<t.length;e++){var i=p.BoardSpaceXY(this.screenSize,this.inputBoxCount,3,t[e],2,100,300),s=i.x,h=i.y,r=(i.width,i.height),a=this.add.rectangle(s,h,5,r,m.cols.red).setDepth(-10).setOrigin(.5,.5).setDepth(2);a.isStroked=this.debug.dropZone,a.strokeColor=m.cols.red,this.debugRects.push(a)}}DebugDropAnItem(){this.debug.dropItemAtStart&&(this.SpawnIngredient(0,0),this.time.delayedCall(500,this.SpawnIngredient,[0,2],this))}DebugDropABurger(){this.debug.dropBurgerAtStart&&(this.gameStarted=!0,this.SpawnBurger("R"))}ColToLRI(t){return t<=1?this.LR[0]:t>=2?this.LR[1]:(console.log("bad input"),"L")}LRIToCol(t){return"L"==t?Phaser.Math.Between(0,1):Phaser.Math.Between(2,3)}RandLRI(){return this.ColToLRI(Phaser.Math.Between(1,2))}ZMismatch(t){return t<=1&&0==t!=this.left||t>=2&&3==t!=this.right}}class P extends Phaser.Scene{constructor(){super({key:"PreloadBurger"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.image("bg","assets/img/bb/burgerbg.png"),this.load.image("burgerTop","assets/img/bb/burgertop.png"),this.load.image("burgerUI","assets/img/burger.png"),this.load.image("crownUI","assets/img/crown.png"),this.load.spritesheet("girl","assets/img/bb/burgergirl.png",{frameHeight:360,frameWidth:648}),this.load.spritesheet("girlSmile","assets/img/bb/burgergirlsmile.png",{frameHeight:360,frameWidth:648}),this.load.spritesheet("girlScowl","assets/img/bb/burgergirlscowl.png",{frameHeight:360,frameWidth:648}),this.load.spritesheet("ingred","assets/img/bb/burgermid.png",{frameHeight:80,frameWidth:204})}create(){this.scene.start("MainBurger")}}class k extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"alien"),this.name="alien",this.colsCount=6,this.targetPos={x:0,y:0},t.add.existing(this),t.physics.add.existing(this);var s=[2,1,0],h=Phaser.Math.Between(0,this.colsCount-1);this.randCol=h;for(var r=0;r<s.length;r++)s[r]*=this.colsCount,s[r]+=h;for(this.setFrame(s[0]),t.anims.create({key:"goUp"+h,frames:t.anims.generateFrameNumbers("alien",{frames:s}),frameRate:16,yoyo:!1,repeat:0}),s=[3,4],r=0;r<s.length;r++)s[r]*=this.colsCount,s[r]+=h;t.anims.create({key:"dying"+h,frames:t.anims.generateFrameNumbers("alien",{frames:s}),frameRate:4,yoyo:!1,repeat:0}),this.targetPos={x:e,y:i},this.timer=this.scene.time.addEvent({delay:1e3,callback:this.SetNewPos,args:[],callbackScope:this,repeat:-1})}update(t){super.update,this.Animate(t)}SetNewPos(){for(var t,e,i=this.screenSize;t=this.targetPos.x+Phaser.Math.Between(-80,80),e=this.targetPos.y+Phaser.Math.Between(-80,80),t=p.Clamp(t,.1*i[0],.9*i[0]),e=p.Clamp(e,.1*i[1],.5*i[1]),!(Math.abs(t-this.x)+Math.abs(e-this.y)>50););this.targetPos={x:t,y:e},this.play("goUp"+this.randCol)}Animate(t){this.x=p.Lerp(this.x,this.targetPos.x,.85/t),this.y=p.Lerp(this.y,this.targetPos.y,.85/t)}SetSize(t,e){this.setSize(t,e),this.setDisplaySize(t,e)}SetDeath(){this.timer.remove(),this.play("dying"+this.randCol),this.scene.time.addEvent({delay:500,callback:this.Die,args:[],callbackScope:this,repeat:0})}Die(){this.destroy()}}class B extends Phaser.Scene{constructor(){super({key:"MainAlienbreak"}),this.debug={collPositions:!1,testExplosion:!1,testDestroySpaceship:!1},this.cLog={},this.paddleRadius=75,this.spaceshipRadius=100,this.ballRadius=0,this.ballSpeedSetting=0,this.ballSpeeds=[1,1.3,1.5],this.spaceShipHitPoints=3,this.targetX=100,this.targetY=0,this.nextSetTargetX=100,this.alienRadius=60,this.lastCollWithPaddle=!1,this.startTime=0,this.score=0,this.bestScore=0}create(){this.groupObj=this.physics.add.staticGroup({defaultKey:"asdf"}),this.groupAlien=this.physics.add.staticGroup({defaultKey:"asdf"}),this.screenSize=[this.cameras.main.width,this.cameras.main.height],this.cameras.main.setBounds(0,0,this.screenSize[0],this.screenSize[1]),this.physics.world.setBounds(0,0,this.screenSize[0],1.1*this.screenSize[1]),this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)})),this.physics.world.on("worldbounds",(t=>this.OnWorldBounds(t))),this.CreateObjs(),this.CreateUI();for(var t=0;t<this.ballSpeeds.length;t++)this.ballSpeeds[t]=this.ballSpeeds[t]*this.screenSize[1]*.7;this.TestExplosion(),this.TestDestroySpaceship()}CreateObjs(){var t,e=this.physics.add.image(0,0,"background");e.setOrigin(0);var i;i=320/208<this.screenSize[0]/this.screenSize[1]?this.screenSize[0]/1280:this.screenSize[1]/832,e.setDisplaySize(1280*i,832*i),this.paddle=this.add.rectangle(this.screenSize[0]/2,this.screenSize[1]/9*8,this.screenSize[0]/6,this.screenSize[1]/30,m.cols.white),this.paddle.setOrigin(.5),null===(t=this.groupObj)||void 0===t||t.add(this.paddle),this.spaceship=this.add.sprite(0,-100,"spaceship",0).setDepth(10).setDisplaySize(this.spaceshipRadius,this.spaceshipRadius),this.spaceship.anims.create({key:"idle",frames:this.anims.generateFrameNames("spaceship",{frames:[0,2,4]}),frameRate:6,yoyo:!1,repeat:-1}),this.spaceship.play("idle"),this.targetY=-100,this.explosion=this.add.sprite(0,0,"explosion",0),this.explosion.anims.create({key:"exp",frames:this.anims.generateFrameNumbers("explosion",{start:0,end:27}),frameRate:128,yoyo:!1,repeat:0}),this.explosion.setFrame(27),this.explosion.setOrigin(.5).setDepth(11)}CreateBall(){this.ballRadius=50,this.ball=this.physics.add.image(this.screenSize[0]/2,this.screenSize[1]/4,"beachball"),this.ball.body.setCollideWorldBounds(),this.ball.body.onWorldBounds=!0,this.ball.body.setBounce(1,1),this.ball.body.setMaxSpeed(this.ballSpeeds[this.ballSpeeds.length-1]),this.ball.body.setVelocity(0,this.ballSpeeds[0]),this.ball.setOrigin(.5),this.ball.setDisplaySize(this.ballRadius,this.ballRadius)}PointerDown(t){this.paddle.setPosition(t.x,this.paddle.y),this.CheckStartGame()}PointerHeld(){}PointerHeldIterate(t){}PointerMove(t){this.PointerDown(t)}PointerUp(t){}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){var i;this.PointerHeld(),this.CheckCollisions(),this.HandleSpaceship(e),this.AnimateRectCol(),null===(i=this.groupAlien)||void 0===i||i.children.entries.forEach((t=>{t.update(e)}))}SetBallSpeed(t=-1){this.ballSpeedSetting++,this.ballSpeedSetting=p.Clamp(this.ballSpeedSetting,0,this.ballSpeeds.length-1)}HandleSpaceship(t){this.time.now>this.nextSetTargetX&&(this.nextSetTargetX=this.time.now+5e3,this.targetX=Phaser.Math.Between(.1*this.screenSize[0],.9*this.screenSize[0])),this.spaceship.x=p.Lerp(this.spaceship.x,this.targetX,.85/t),this.spaceship.y=p.Lerp(this.spaceship.y,this.targetY,.85/t)}SpawnAliensStart(){this.gameStarted&&(this.SpawnAliens(),this.spawningTimer=this.time.addEvent({delay:3500,callback:this.SpawnAliens,args:[],callbackScope:this,repeat:-1}))}SpawnAliens(){var t=Phaser.Math.Between(2,3);this.screenSize[0],this.time.addEvent({delay:50,callback:this.SpawnAlien,args:[],callbackScope:this,repeat:t-1})}SpawnAlien(){var t,e=new k(this,this.spaceship.x,0).setDepth(9);null===(t=this.groupAlien)||void 0===t||t.add(e),e.setDisplaySize(this.alienRadius,this.alienRadius),e.screenSize=this.screenSize}StopSpawns(t=!1){this.spawningTimer.remove(),t&&this.time.addEvent({delay:1e3,callback:this.StartSpaceship,callbackScope:this})}OnWorldBounds(t){this.lastCollWithPaddle=!1,this.ball.body.y>this.paddle.y&&(this.LoseLife(),this.StopSpawns(),this.KillAllAliens(!1),this.cameras.main.shake(100,.02))}CustomCollCheck(t,e,i,s){return p.CheckCirclesOverlap(t,e,.77*i,.8*s)}CheckCollisions(){var t;if(this.gameStarted){var e=this.ball.body;e=new Phaser.Math.Vector2(e.x+this.ballRadius/2,e.y+this.ballRadius/2);var i,s=this.ballRadius/Math.PI,h=this.paddle.getBounds();h.x+=.5*h.width,h.width*=1,h.height*=1,p.CheckCircleRectIntersect(e,s,h)&&this.CollWithPaddle(),(null===(t=this.groupAlien)||void 0===t?void 0:t.children.entries).forEach((t=>{i={x:t.x,y:t.y},this.CustomCollCheck(i,e,s,this.alienRadius)&&this.CollWithAlien(t)})),i=this.spaceship,this.CustomCollCheck(i,e,s,this.spaceshipRadius)&&this.CollWithSpaceship()}}CollWithPaddle(){this.lastCollWithPaddle||(this.lastCollWithPaddle=!0,this.SetBallSpeed(),this.BallBounce(this.paddle))}CollWithAlien(t){var e;this.lastCollWithPaddle=!1,null===(e=this.groupAlien)||void 0===e||e.remove(t),t.SetDeath(),this.SetScore(),this.BallBounce(t)}CollWithSpaceship(){this.lastCollWithPaddle=!1,this.spaceShipHitPoints<=0||(this.spaceShipHitPoints--,this.spaceShipHitPoints<=0?(this.KillAllAliens(!0),this.StopSpawns(!0),this.targetY=-100,this.SetBallSpeed(0),this.cameras.main.shake(100,.02),this.SetScore(),this.PlayExplosionShipDeath()):(this.PlayExplosionShipInjure(),this.BallBounce(this.spaceship)))}KillAllAliens(t){var e;(null===(e=this.groupAlien)||void 0===e?void 0:e.children.entries).forEach((e=>{e.SetDeath(),t&&this.SetScore()}))}BallBounce(t){var e=this.ball.body,i=new Phaser.Math.Vector2(e.x+this.ballRadius/2,e.y+this.ballRadius/2);this.debug.collPositions&&(this.add.circle(this.ball.body.x,this.ball.body.y,5,m.cols.red),this.add.circle(e.x+this.ballRadius/2,e.y+this.ballRadius/2,5,m.cols.black),this.add.circle(t.x,t.y,5,m.cols.black),this.scene.pause()),(i=i.subtract(t)).normalize(),i.setLength(this.ballSpeeds[this.ballSpeedSetting]),this.ball.setVelocity(i.x,i.y),this.ball.setAngularVelocity(180*i.angle())}CheckStartGame(){this.gameStarted||(this.KillAllAliens(!1),this.SetBallSpeed(0),this.gameStarted=!0,this.startTime=this.time.now,this.CreateBall(),this.StartSpaceship())}StartSpaceship(){this.targetY=0,this.spaceShipHitPoints=3,this.SpawnAliensStart()}LoseLife(){this.gameStarted=!1,this.SetScore(0),this.ball.destroy(),this.PlayExplosionPlayer()}ScoreByTime(){this.SetScore(Math.round(1e4*(this.time.now-this.startTime+Number.EPSILON))/100)}SetScore(t=-1){-1==t?this.score++:this.score=t,this.score>this.bestScore&&(this.bestScore=this.score),this.UpdateScoreUI()}PlayExplosionShipDeath(){this.ExplosionHelp(this.spaceship.x,this.spaceship.y+15,1)}PlayExplosionShipInjure(){this.ExplosionHelp(this.spaceship.x,this.spaceship.y+15,.2)}PlayExplosionPlayer(){this.ExplosionHelp(this.paddle.x,this.paddle.y,.8)}ExplosionHelp(t,e,i){this.explosion.setPosition(t,e),this.explosion.setScale(i),this.explosion.play("exp")}AnimateRectCol(){this.paddle.setStrokeStyle(2,p.RainbowColor(this.time.now/800),1)}TestExplosion(){this.debug.testExplosion&&this.time.addEvent({delay:1e3,callback:this.PlayExplosionShipDeath,args:[],callbackScope:this,repeat:10})}TestDestroySpaceship(){this.debug.testDestroySpaceship&&(this.time.addEvent({delay:2990,callback:this.TDSHelp,callbackScope:this}),this.time.addEvent({delay:3e3,callback:this.CollWithSpaceship,callbackScope:this}))}TDSHelp(){this.spaceShipHitPoints=1}CreateUI(){var t=this.CreateText();this.currScoreText=t,t.setPosition(20,this.screenSize[1]-70);var e=this.CreateText();this.bestScoreText=e,e.setPosition(50,this.screenSize[1]-30);var i=this.add.image(0,0,"crown");i.setOrigin(.5,.5).setDepth(10),i.setPosition(33,this.screenSize[1]-30)}CreateText(){return this.add.text(0,0,"0",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',fontSize:"40px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10).setOrigin(0,.5)}UpdateScoreUI(){this.currScoreText.setText(this.score),this.bestScoreText.setText(this.bestScore)}}class T extends Phaser.Scene{constructor(){super({key:"PreloadAlienbreak"})}preload(){this.load.image("wall","assets/img/wall.png"),this.load.image("ball","assets/img/ball.png"),this.load.image("beachball","assets/img/beachball.png"),this.load.image("background","assets/img/bb/alienBackground.png"),this.load.image("ultraman","assets/img/ultraman.png"),this.load.image("crown","assets/img/crown.png"),this.load.spritesheet("alien","assets/img/bb/alien.png",{frameHeight:48,frameWidth:48}),this.load.spritesheet("spaceship","assets/img/bb/spaceship.png",{frameHeight:80,frameWidth:77}),this.load.spritesheet("explosion","assets/img/hires/explosion.png",{frameHeight:232,frameWidth:136})}create(){this.scene.start("MainAlienbreak")}}class D extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"bobble"),this.name="bobble",this.moving=!1,this.isStar=!1,this.tetherMark=-1,this.yVel=.05,this.accel=.03,t.add.existing(this),t.physics.add.existing(this),t.anims.create({key:"pop",frames:t.anims.generateFrameNumbers("pop",{start:0,end:5}),frameRate:16,yoyo:!1,repeat:0}),t.anims.create({key:"star",frames:t.anims.generateFrameNumbers("star",{start:0,end:5}),frameRate:16,yoyo:!1,repeat:-1,repeatDelay:2e3})}update(){super.update}SetSize(t,e){this.setSize(t,e),this.setDisplaySize(t,e)}SetColRand(){this.SetCol(Phaser.Math.Between(0,4))}SetCol(t){this.col=t,this.setFrame(t)}SetStar(){this.isStar=!0,this.play("star")}SetPop(){this.play("pop"),this.scene.time.addEvent({delay:1500,callback:this.destroy,args:[],callbackScope:this,repeat:0})}SetUntethered(t){this.yVel+=.15*t}}class A extends Phaser.Scene{constructor(){super({key:"MainBobble"}),this.grid={longRowX:Array(),shortRowX:Array(),highestRowOffset:!1,rowOffset:0,edgeSpacer:10,bobbleSize:50,state:Array(),launchPos:{x:0,y:0},tileCount:{x:0,y:0}},this.rates={star:25,nextRow:7},this.maxColsInd=7,this.colsInSubset=5,this.colsSubset=Array(),this.longRow=Array(),this.shortRow=Array(),this.bobbleFiringSpeed=0,this.bobbleSpeed={x:0,y:0},this.bobblesSet=0,this.currentMark=0,this.firstRun=!0,this.score=0,this.bestScore=0,this.debug={testCreateRow:!1,testGenRows:!1,debugEdgesSpacers:!1,closestBobbleInds:!1},this.cLog={logAfterInit:!1}}create(){this.screenSize={x:this.cameras.main.width,y:this.cameras.main.height},this.screenSizeArr=[this.cameras.main.width,this.cameras.main.height],this.groupTopBobbles=this.physics.add.staticGroup({defaultKey:"asdf"}),this.groupUntethered=this.physics.add.staticGroup({defaultKey:"asdf"}),this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)})),this.PrepGrid(),this.CreateObjs(),this.RunDebugs(),this.CreateUI(),this.StartGame(),this.PrepNext(!0)}CreateObjs(){this.backgroundA=this.CreateBackground(),this.backgroundB=this.CreateBackground(),this.backgroundB.setPosition(this.screenSize.x/2,this.backgroundB.displayHeight)}CreateBackground(){var t=this.physics.add.image(this.screenSize.x/2,0,"background");return t.setOrigin(.5,0),p.FitBackgroundToScreen(this.screenSize,t,{x:640,y:1344}),t}PrepGrid(){this.screenSize.x,this.grid.edgeSpacer,this.grid.bobbleSize,this.grid.tileCount.x=Math.floor(this.screenSize.x/this.grid.bobbleSize),this.grid.tileCount.x=p.Clamp(this.grid.tileCount.x,8,1e5),this.grid.bobbleSize=this.BSXYCustom(1).x-this.BSXYCustom(0).x,this.grid.rowOffset=Math.sin(p.DegToRad(60))*this.grid.bobbleSize;for(var t=0;t<this.grid.tileCount.x;t++){var e=this.BSXYCustom(t);this.grid.longRowX.push(e.x)}for(t=.5;t<this.grid.tileCount.x-1;t++)e=this.BSXYCustom(t),this.grid.shortRowX.push(e.x);this.grid.launchPos={x:this.screenSize.x/2,y:.9*this.screenSize.y},this.InitGridState(),this.bobbleFiringSpeed=this.screenSize.y/60}BSXYCustom(t){return p.BoardSpaceXY([this.screenSize.x,this.screenSize.x],this.grid.tileCount.x,this.grid.tileCount.x,t,0,this.grid.edgeSpacer,0)}InitGridState(){this.grid.tileCount.y=Math.floor(this.screenSize.y/this.grid.bobbleSize),this.grid.state=Array.from({length:this.grid.tileCount.y},((t,e)=>Array.from({length:this.grid.tileCount.x},((t,e)=>null))))}CreateRow(){this.grid.highestRowOffset=!this.grid.highestRowOffset,this.CreateRowHelp(0,this.grid.highestRowOffset),this.OffsetAll()}CreateRowHelp(t,e){var i,s=this.grid.longRowX;e&&(s=this.grid.shortRowX);for(var h=Array(),r=0;r<s.length;r++){var a=this.CreateBobble(s[r],t);null===(i=this.groupTopBobbles)||void 0===i||i.add(a),h.push(a)}this.grid.state.unshift(h)}CreateBobble(t,e){var i=new D(this,t,e);return i.setOrigin(.5),i.SetSize(this.grid.bobbleSize,this.grid.bobbleSize),i.SetCol(this.colsSubset[Phaser.Math.Between(0,this.colsInSubset-1)]),i}CheckGenerateRow(){this.bobblesSet%this.rates.nextRow==0&&this.CreateRow()}RemoveBobble(t,e,i,s=!0){var h,r,a=this.grid.state,o=a[e][t];i?(o.SetUntethered(e),null===(h=this.groupUntethered)||void 0===h||h.add(o)):o.SetPop(),null===(r=this.groupTopBobbles)||void 0===r||r.remove(o,!1,!1),a[e][t]=null,s&&this.SetScore()}HandleUntethered(t){var e;(null===(e=this.groupUntethered)||void 0===e?void 0:e.children.entries).forEach((e=>{var i;e.yVel+=e.accel,e.setPosition(e.x,e.y+e.yVel*t),e.y>this.screenSize.y+500&&(null===(i=this.groupUntethered)||void 0===i||i.remove(e,!0,!0))}))}PointerDown(t){this.GetAimDir(t).y}PointerHeld(){this.input.activePointer.isDown}PointerMove(t){this.PointerDown(t)}PointerUp(t){var e=this.GetAimDir(t);e.y>-2||(this.movingBobble=this.nextBobble,this.movingBobble.moving||(this.movingBobble.moving=!0,this.bobbleSpeed=e))}GetAimDir(t){var e=this.grid.launchPos,i=new Phaser.Math.Vector2(-e.x+t.x,-e.y+t.y);return i.angle(),i.normalize(),i.scale(this.bobbleFiringSpeed),i}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.PointerHeld(),this.MoveCollBobble(),this.AnimateBackgrounds(e),this.HandleUntethered(e)}MoveCollBobble(){var t;if(null!=this.movingBobble&&0!=this.movingBobble.moving){var e=this.grid.edgeSpacer,i=this.grid.bobbleSize/1.2,s=this.movingBobble.x+this.bobbleSpeed.x;s-i<e?(s+=e-(s-i),this.bobbleSpeed.x*=-1):s+i>this.screenSize.x-e&&(s+=this.screenSize.x-e-(s+i),this.bobbleSpeed.x*=-1);var h=this.movingBobble.y+this.bobbleSpeed.y;h<this.grid.rowOffset?this.BobbleColl(-1):(this.movingBobble.x=s,this.movingBobble.y=h,i=this.grid.bobbleSize/2,(null===(t=this.groupTopBobbles)||void 0===t?void 0:t.children.entries).forEach((t=>{p.CheckCirclesOverlap(t,this.movingBobble,.8*i,i)&&this.BobbleColl(t.col)})))}}AnimateBackgrounds(t){this.AnimateBackground(this.backgroundA,t),this.AnimateBackground(this.backgroundB,t)}AnimateBackground(t,e){var i=1e-8*this.screenSize.y;t.setOrigin(t.originX,t.originY+i*e),t.originY>=1&&t.setOrigin(t.originX,t.originY-1)}BobbleColl(t){var e;if(0!=this.movingBobble.moving){this.movingBobble.moving=!1,this.grid;var i=this.movingBobble,s=this.grid.state;if(i.isStar){for(var h=0;h<s.length;h++)for(var r=0;r<s[h].length;r++){var a=s[h][r];null!=a&&a.col==t&&this.RemoveBobble(r,h,!1)}this.CheckUntethered(),i.SetPop()}if(!i.isStar){var o=this.FindNearestInd(i),l=this.IndToPos(o.x,o.y);i.setPosition(l.x,l.y),this.grid.state[o.y-1][o.x]=i,null===(e=this.groupTopBobbles)||void 0===e||e.add(this.movingBobble),this.CheckElim(o.x,o.y-1,i.col)}this.PrepNext(),this.bobblesSet++,this.CheckGenerateRow(),this.CheckLose()}}FindNearestInd(t){var e=this.grid,i=0;for(i=0;i<e.state.length+1&&!(i*e.rowOffset>t.y);i++);var s,h=this.FindNearestXsOnY(t.x,i),r=this.FindNearestXsOnY(t.x,i-1),a={x:h.a,y:i},o={x:h.b,y:i},l={x:r.a,y:i-1},n={x:r.b,y:i-1};if(this.CheckTaken(a))if(this.CheckTaken(o)){if(this.CheckTaken(l))return n;s=l}else s=o;else s=a;return this.CheckTaken(o)||(s=this.FindCloserByInd(t,s,o)),0==i||(this.CheckTaken(l)||(s=this.FindCloserByInd(t,s,l)),this.CheckTaken(n)||(s=this.FindCloserByInd(t,s,n))),s}FindNearestXsOnY(t,e){this.grid;var i,s=this.RowPosArrByY(e);for(i=0;i<s.length&&!(s[i]>t);i++);var h={a:i,b:0};return h.b=i-1,0==i&&(h.b=0),h}FindCloserByInd(t,e,i){var s=p.FindCloserV2(t,this.IndToPos(e.x,e.y),this.IndToPos(i.x,i.y));return p.ApproxV2(s,this.IndToPos(e.x,e.y))?e:i}CheckTaken(t){if(this.debug.closestBobbleInds){var e=this.IndToPos(t.x,t.y);this.add.circle(e.x,e.y,5,m.cols.red),console.log(t.y-1,t.x)}return null!=this.grid.state[t.y-1][t.x]}QueueIndHexa(t,e,i){t.push({x:e-1,y:i}),t.push({x:e+1,y:i}),this.yIsOffset(i)||e--,t.push({x:e,y:i-1}),t.push({x:e+1,y:i-1}),t.push({x:e,y:i+1}),t.push({x:e+1,y:i+1})}CheckElim(t,e,i){var s=this.grid.state,h=Array(),r=Array();r.push({x:t,y:e});for(var a=this.grid.longRowX.length;r.length>0;){var o=(u=r.shift()).x,l=u.y,n=a;this.yIsOffset(l)&&n--,p.OOB(o,n)||p.OOB(l,this.grid.state.length)||null!=(g=s[u.y][u.x])&&(g.markedForElim||g.col==i&&(g.markedForElim=!0,h.push(u),this.QueueIndHexa(r,o,l)))}var d=h.length>=3;for(var c in h){var u,g=s[(u=h[c]).y][u.x];d?this.RemoveBobble(u.x,u.y,!1):g.markedForElim=!1}d&&this.CheckUntethered()}CheckUntethered(){this.currentMark++;for(var t=this.currentMark,e=this.grid.state,i=Array(),s=0;s<e[0].length;s++)i.push({x:s,y:0});for(var h,r=this.grid.longRowX.length;i.length>0;){var a=(h=i.shift()).x,o=h.y,l=r;this.yIsOffset(o)&&l--,p.OOB(a,l)||p.OOB(o,e.length)||null!=(c=e[h.y][h.x])&&c.tetherMark!=t&&(c.tetherMark=t,this.QueueIndHexa(i,a,o))}for(var n=0;n<e.length;n++)for(var d=0;d<e[n].length;d++){var c;null!=(c=e[n][d])&&c.tetherMark!=t&&this.RemoveBobble(d,n,!0)}}PrepNext(t=!1){var e=this.grid.launchPos,i=this.grid.bobbleSize;t&&(this.futureBobble=this.CreateBobble(e.x-1.5*i,e.y)),this.nextBobble=this.futureBobble,this.futureBobble=this.CreateBobble(e.x-1.5*i,e.y),i=this.grid.bobbleSize,this.futureBobble.setAlpha(.5).SetSize(.8*i,.8*i),this.nextBobble.setAlpha(1).SetSize(i,i),this.nextBobble.setPosition(e.x,e.y),(this.bobblesSet+1)%this.rates.star==0&&this.futureBobble.SetStar()}OffsetAll(){var t;(null===(t=this.groupTopBobbles)||void 0===t?void 0:t.children.entries).forEach((t=>{t.y+=this.grid.rowOffset})),this.grid.state.pop()}StartGame(){var t;for(this.bobblesSet=0,this.SetScore(0),this.colsSubset=Array();this.colsSubset.length!=this.colsInSubset;){var e=Phaser.Math.Between(0,this.maxColsInd);this.colsSubset.includes(e)||this.colsSubset.push(e)}if(!this.firstRun)for(var i=0;i<2;i++)null===(t=this.nextBobble)||void 0===t||t.SetPop(),this.PrepNext();this.firstRun=!1,this.CreateRow(),this.CreateRow(),this.CreateRow()}EndGame(){this.ClearBoard(),this.StartGame()}CheckLose(){for(var t=this.grid.state,e=t[t.length-1],i=0;i<e.length;i++)null!=e[i]&&this.EndGame()}ClearBoard(){for(var t=this.grid.state,e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)null!=t[e][i]&&this.RemoveBobble(i,e,!0,!1)}SetScore(t=-1){-1==t?this.score++:this.score=t,this.score>this.bestScore&&(this.bestScore=this.score),this.UpdateScoreUI()}CreateUI(){var t=this.CreateText();this.currScoreText=t,t.setPosition(20,this.screenSize.y-70);var e=this.CreateText();this.bestScoreText=e,e.setPosition(50,this.screenSize.y-30);var i=this.add.image(0,0,"crown");i.setOrigin(.5,.5).setDepth(10),i.setPosition(33,this.screenSize.y-30)}CreateText(){return this.add.text(0,0,"0",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',fontSize:"40px",color:"#000000",stroke:"#ffffff",strokeThickness:4}).setDepth(10).setOrigin(0,.5)}UpdateScoreUI(){this.currScoreText.setText(this.score),this.bestScoreText.setText(this.bestScore)}IndToPos(t,e){var i=this.grid,s=this.RowPosArrByY(e);return p.OOB(t,s.length)&&(t=0),{x:s[t],y:e*i.rowOffset}}yIsOffset(t){return t%2==(this.grid.highestRowOffset?0:1)}RowPosArrByY(t){return this.yIsOffset(t)?this.grid.longRowX:this.grid.shortRowX}RunDebugs(){this.TestCreateRow(),this.DebugEdgesSpacers(),this.TestGenerateRows(),this.cLog.logAfterInit&&this.DebugGridState()}DebugEdgesSpacers(){this.debug.debugEdgesSpacers&&(this.add.circle(0,140,50,m.cols.red),this.add.circle(this.screenSize.x,140,50,m.cols.red))}TestCreateRow(){this.debug.testCreateRow&&(this.CreateRowHelp(100,!1),this.CreateRowHelp(100-this.grid.rowOffset,!0))}TestGenerateRows(){this.debug.testGenRows&&(this.CreateRow(),this.CreateRow(),this.CreateRow())}DebugGridState(){for(var t=Array(),e=0;e<this.grid.state.length;e++){for(var i=Array(),s=0;s<this.grid.state[0].length;s++){var h="_";null!=this.grid.state[e][s]&&(h=this.grid.state[e][s].col),i.push(h.toString())}t.push(i)}console.log(t)}}class z extends Phaser.Scene{constructor(){super({key:"PreloadBobble"})}preload(){this.load.image("background","assets/img/bobble/bobble.png"),this.load.spritesheet("bobble","assets/img/bobble/bobbles.png",{frameHeight:64,frameWidth:64}),this.load.spritesheet("star","assets/img/bobble/bobbleStar.png",{frameHeight:64,frameWidth:64}),this.load.spritesheet("pop","assets/img/bobble/bobblePop.png",{frameHeight:64,frameWidth:64}),this.load.image("crown","assets/img/crown.png")}create(){this.scene.start("MainBobble")}}class M extends Phaser.Physics.Arcade.Sprite{constructor(t,e,i){super(t,e,i,"ball"),this.name="body",this.travelledDist=0,this.distOnSet=0,t.add.existing(this),t.physics.add.existing(this)}update(){super.update}Follow(t,e,i){var s,h=this.followingPart,r=p.V2Dist(this,h);r<e||((s=0==p.V2Dist(this,this.targetPos)?p.DirTowards(this,h):p.DirTowards(this,this.targetPos)).setLength(i*t+.0055*r),this.setPosition(p.Lerp(this.x,this.x+s.x,.9),p.Lerp(this.y,this.y+s.y,.9)),this.travelledDist+=s.length(),this.distOnSet<this.travelledDist&&(this.targetPos={x:h.x,y:h.y},this.distOnSet=r,this.travelledDist=0))}SetSize(t,e){this.setSize(t,e),this.setDisplaySize(t,e)}}class I extends Phaser.Scene{constructor(){super({key:"MainSnake"}),this.snakeHeadSize=30,this.bodyCount=1,this.headSpeed=.1,this.headNearDist=5,this.headRotSpeed=.005,this.headRotMax=.03,this.bodyNearDist=25,this.eatDist=50,this.startPartsNum=4,this.debug={testBodyParts:!1,testMeat:!0},this.cLog={}}create(){this.screenSize={x:this.cameras.main.width,y:this.cameras.main.height},this.screenSizeArr=[this.cameras.main.width,this.cameras.main.height],this.screenCenter={x:this.screenSize.x/2,y:this.screenSize.y/2},this.groupBody=this.physics.add.staticGroup({defaultKey:"asdf"}),this.groupMeat=this.physics.add.staticGroup({}),this.input.on("pointerup",(t=>{this.PointerUp(t)})),this.input.on("pointerdown",(t=>{this.PointerDown(t)})),this.input.on("pointermove",(t=>{this.PointerMove(t)}));var t=this.screenCenter;this.snakeHead=new M(this,t.x,t.y).setOrigin(.5,.5).setDepth(10).setDisplaySize(this.snakeHeadSize,this.snakeHeadSize).setTexture("snakeHead"),this.snakeHead.num=0,this.snakeHead.targetPos=t,this.headTargetInd=this.add.image(-100,-100,"ball").setOrigin(.5).setDisplaySize(.7*this.snakeHeadSize,.7*this.snakeHeadSize).setTint(m.cols.orange).setAlpha(.5),this.RestartGame(),this.RunDebugs()}GenBodyPart(){var t,e=new M(this,0,0).setOrigin(.5,.5).setDepth(1).setDisplaySize(this.snakeHeadSize,this.snakeHeadSize);e.followingPart=this.previousPart,e.targetPos={x:this.previousPart.x,y:this.previousPart.y},e.setPosition(this.previousPart.x,this.previousPart.y),e.num=this.bodyCount,this.bodyCount++,null===(t=this.groupBody)||void 0===t||t.add(e),this.previousPart=e}GenBodyParts(t){for(var e=0;e<t;e++)this.GenBodyPart()}GenMeat(){for(var t,e,i=this.screenSize;e={x:Phaser.Math.Between(.1*i.x,.9*i.x),y:Phaser.Math.Between(.1*i.y,.9*i.y)},!p.V2Dist(e,this.snakeHead<80););var s=this.add.image(e.x,e.y,"meat").setDepth(9);null===(t=this.groupMeat)||void 0===t||t.add(s)}PointerDown(t){this.headTargetInd.setPosition(t.x,t.y),this.snakeHead.targetPos={x:t.x,y:t.y}}PointerHeld(){this.input.activePointer.isDown}PointerMove(t){this.PointerDown(t)}PointerUp(t){}update(t,e){try{this.trycatch(t,e)}catch(t){console.log(t)}}trycatch(t,e){this.PointerHeld(),this.MoveHead(e),this.CheckMeat()}MoveHead(t){var e=this.snakeHead,i=e.targetPos;if(!(p.V2Dist(e,i)<this.headNearDist)){var s=p.DirTowards(e,i).angle(),h=e.rotation;h<0&&(h+=2*Math.PI);var r=p.V2TurnTowards(h,s);Math.abs(r)>1e-5&&(r*=this.headRotSpeed*t,r=p.Clamp(r,-this.headRotMax,this.headRotMax),e.rotation=e.rotation+r);var a=p.AngToV2(e.rotation);a.setLength(this.headSpeed*t),e.setPosition(e.x+a.x,e.y+a.y);var o=this.screenSize;p.OOB(e.x,o.x)||p.OOB(e.y,o.y)?this.RestartGame():this.HandleBody(t)}}HandleBody(t){for(var e,i=null===(e=this.groupBody)||void 0===e?void 0:e.children.entries,s=i.length-1;s>=0;s--){var h=i[s];if(h.num>this.startPartsNum&&p.V2Dist(h,this.snakeHead)<.7*this.snakeHeadSize)return void this.RestartGame();h.Follow(t,this.bodyNearDist,this.headSpeed)}}CheckMeat(){var t;null===(t=this.groupMeat)||void 0===t||t.children.entries.forEach((t=>{var e;p.V2Dist(t,this.snakeHead)<this.snakeHeadSize&&(null===(e=this.groupMeat)||void 0===e||e.remove(t,!0,!0),this.GenBodyPart(),this.GenMeat())}))}RestartGame(){var t;this.previousPart=this.snakeHead,this.bodyCount=1,null===(t=this.groupBody)||void 0===t||t.clear(!0,!0),this.GenBodyParts(this.startPartsNum)}RunDebugs(){this.TestBodyParts(6),this.TestGenMeat()}TestBodyParts(t){if(this.debug.testBodyParts)for(var e=0;e<t;e++)this.GenBodyPart()}TestGenMeat(){this.debug.testMeat&&this.GenMeat()}}class O extends Phaser.Scene{constructor(){super({key:"PreloadSnake"})}preload(){this.load.image("ball","assets/img/ball.png"),this.load.image("snakeHead","assets/img/snakeHead.png"),this.load.image("meat","assets/img/meat.png")}create(){this.scene.start("MainSnake")}}const R={type:Phaser.AUTO,backgroundColor:"#33322e",scale:{parent:"phaser-game",mode:Phaser.Scale.NONE,autoCenter:Phaser.Scale.CENTER_BOTH,width:window.innerWidth,height:window.innerHeight},scene:[b,S,a,r,c,d,g,u,C,v,P,f,T,B,z,A,O,I],physics:{default:"arcade",arcade:{debug:!1}},pixelArt:!1};window.addEventListener("load",(()=>{new Phaser.Game(R)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},i={};function s(t){var h=i[t];if(void 0!==h)return h.exports;var r=i[t]={exports:{}};return e[t].call(r.exports,r,r.exports,s),r.exports}s.m=e,t=[],s.O=(e,i,h,r)=>{if(!i){var a=1/0;for(d=0;d<t.length;d++){for(var[i,h,r]=t[d],o=!0,l=0;l<i.length;l++)(!1&r||a>=r)&&Object.keys(s.O).every((t=>s.O[t](i[l])))?i.splice(l--,1):(o=!1,r<a&&(a=r));if(o){t.splice(d--,1);var n=h();void 0!==n&&(e=n)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[i,h,r]},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={179:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var h,r,[a,o,l]=i,n=0;if(a.some((e=>0!==t[e]))){for(h in o)s.o(o,h)&&(s.m[h]=o[h]);if(l)var d=l(s)}for(e&&e(i);n<a.length;n++)r=a[n],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(d)},i=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),s.O(void 0,[216],(()=>s(18)));var h=s.O(void 0,[216],(()=>s(204)));h=s.O(h)})();